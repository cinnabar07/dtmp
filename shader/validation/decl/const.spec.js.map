{"version":3,"file":"const.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","test","desc","params","u","combine","fn","t","wgsl","target","expectCompileResult","attribute","kTypeCases","bool","code","valid","i32","u32","f32","f16","abstract_int","abstract_float","vec2i","vec3u","vec4f","mat2x2","mat4x3f","array_sized","array_runtime","struct","atomic","vec_abstract_int","array_abstract_int","beforeAllSubcases","case","selectDeviceOrSkipTestCase","testcase","expect","kInitCases","no_init","no_type","no_init_no_type","init_matching_type","init_mismatch_type","abs_int_init_convert","abs_float_init_convert","init_const_expr","init_override_expr","init_runtime_expr","init_func","init_non_const_func","undefined","scope","attr"],"sources":["../../../../../src/webgpu/shader/validation/decl/const.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nValidation tests for const declarations\n`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('no_direct_recursion').\ndesc('Test that direct recursion of const declarations is rejected').\nparams((u) => u.combine('target', ['a', 'b'])).\nfn((t) => {\n  const wgsl = `\nconst a : i32 = 42;\nconst b : i32 = ${t.params.target};\n`;\n  t.expectCompileResult(t.params.target === 'a', wgsl);\n});\n\ng.test('no_indirect_recursion').\ndesc('Test that indirect recursion of const declarations is rejected').\nparams((u) => u.combine('target', ['a', 'b'])).\nfn((t) => {\n  const wgsl = `\nconst a : i32 = 42;\nconst b : i32 = c;\nconst c : i32 = ${t.params.target};\n`;\n  t.expectCompileResult(t.params.target === 'a', wgsl);\n});\n\ng.test('no_indirect_recursion_via_array_size').\ndesc('Test that indirect recursion of const declarations via array size expressions is rejected').\nparams((u) => u.combine('target', ['a', 'b'])).\nfn((t) => {\n  const wgsl = `\nconst a = 4;\nconst b = c[0];\nconst c = array<i32, ${t.params.target}>(4, 4, 4, 4);\n`;\n  t.expectCompileResult(t.params.target === 'a', wgsl);\n});\n\ng.test('no_indirect_recursion_via_struct_attribute').\ndesc('Test that indirect recursion of const declarations via struct members is rejected').\nparams((u) =>\nu //\n.combine('target', ['a', 'b']).\ncombine('attribute', ['align', 'location', 'size'])\n).\nfn((t) => {\n  const wgsl = `\nstruct S {\n  @${t.params.attribute}(${t.params.target}) a : i32\n}\nconst a = 4;\nconst b = S(4).a;\n`;\n  t.expectCompileResult(t.params.target === 'a', wgsl);\n});\n\nconst kTypeCases = {\n  bool: {\n    code: `const x : bool = true;`,\n    valid: true\n  },\n  i32: {\n    code: `const x : i32 = 1i;`,\n    valid: true\n  },\n  u32: {\n    code: `const x : u32 = 1u;`,\n    valid: true\n  },\n  f32: {\n    code: `const x : f32 = 1f;`,\n    valid: true\n  },\n  f16: {\n    code: `enable f16;\\nconst x : f16 = 1h;`,\n    valid: true\n  },\n  abstract_int: {\n    code: `\n      const x = 0xffffffffff;\n      const_assert x == 0xffffffffff;`,\n    valid: true\n  },\n  abstract_float: {\n    code: `\n      const x = 3937509.87755102;\n      const_assert x != 3937510.0;\n      const_assert x != 3937509.75;`,\n    valid: true\n  },\n  vec2i: {\n    code: `const x : vec2i = vec2i();`,\n    valid: true\n  },\n  vec3u: {\n    code: `const x : vec3u = vec3u();`,\n    valid: true\n  },\n  vec4f: {\n    code: `const x : vec4f = vec4f();`,\n    valid: true\n  },\n  mat2x2: {\n    code: `const x : mat2x2f = mat2x2f();`,\n    valid: true\n  },\n  mat4x3f: {\n    code: `const x : mat4x3<f32> = mat4x3<f32>();`,\n    valid: true\n  },\n  array_sized: {\n    code: `const x : array<u32, 4> = array(1,2,3,4);`,\n    valid: true\n  },\n  array_runtime: {\n    code: `const x : array<u32> = array(1,2,3);`,\n    valid: false\n  },\n  struct: {\n    code: `struct S { x : u32 }\\nconst x : S = S(0);`,\n    valid: true\n  },\n  atomic: {\n    code: `const x : atomic<u32> = 0;`,\n    valid: false\n  },\n  vec_abstract_int: {\n    code: `\n      const x = vec2(0xffffffffff,0xfffffffff0);\n      const_assert x.x == 0xffffffffff;\n      const_assert x.y == 0xfffffffff0;`,\n    valid: true\n  },\n  array_abstract_int: {\n    code: `\n      const x = array(0xffffffffff,0xfffffffff0);\n      const_assert x[0] == 0xffffffffff;\n      const_assert x[1] == 0xfffffffff0;`,\n    valid: true\n  }\n};\n\ng.test('type').\ndesc('Test const types').\nparams((u) => u.combine('case', keysOf(kTypeCases))).\nbeforeAllSubcases((t) => {\n  if (t.params.case === 'f16') {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  }\n}).\nfn((t) => {\n  const testcase = kTypeCases[t.params.case];\n  const code = testcase.code;\n  const expect = testcase.valid;\n  t.expectCompileResult(expect, code);\n});\n\nconst kInitCases = {\n  no_init: {\n    code: `const x : u32;`,\n    valid: false\n  },\n  no_type: {\n    code: `const x = 0;`,\n    valid: true\n  },\n  no_init_no_type: {\n    code: `const x;`,\n    valid: false\n  },\n  init_matching_type: {\n    code: `const x : i32 = 1i;`,\n    valid: true\n  },\n  init_mismatch_type: {\n    code: `const x : u32 = 1i;`,\n    valid: false\n  },\n  abs_int_init_convert: {\n    code: `const x : u32 = 1;`,\n    valid: true\n  },\n  abs_float_init_convert: {\n    code: `const x : f32 = 1.0;`,\n    valid: true\n  },\n  init_const_expr: {\n    code: `const x = 0;\\nconst y = x + 2;`,\n    valid: true\n  },\n  init_override_expr: {\n    code: `override x : u32;\\nconst y = x * 2;`,\n    valid: false\n  },\n  init_runtime_expr: {\n    code: `var<private> x = 1i;\\nconst y = x - 1;`,\n    valid: false\n  },\n  init_func: {\n    code: `const x = max(1,2);`,\n    valid: true\n  },\n  init_non_const_func: {\n    code: `const x = foo(1);\n    fn foo(p : i32) -> i32 { return p; }`,\n    valid: false\n  }\n};\n\ng.test('initializer').\ndesc('Test const initializers').\nparams((u) => u.combine('case', keysOf(kInitCases))).\nfn((t) => {\n  const testcase = kInitCases[t.params.case];\n  const code = testcase.code;\n  const expect = testcase.valid;\n  t.expectCompileResult(expect, code);\n});\n\ng.test('function_scope').\ndesc('Test that const declarations are allowed in functions').\nfn((t) => {\n  const code = `fn foo() { const x = 0; }`;\n  t.expectCompileResult(true, code);\n});\n\ng.test('immutable').\ndesc('Test that const declarations are immutable').\nfn((t) => {\n  const code = `\n    const x = 0;\n    fn foo() {\n      x = 1;\n    }`;\n  t.expectCompileResult(false, code);\n});\n\ng.test('assert').\ndesc('Test value can be checked by a const_assert').\nfn((t) => {\n  const code = `\n    const x = 0;\n    const_assert x == 0;`;\n  t.expectCompileResult(true, code);\n});\n\ng.test('placement').\ndesc('Tests @const is not allowed to appear').\nparams((u) =>\nu.combine('scope', [\n'private-var',\n'storage-var',\n'struct-member',\n'fn-decl',\n'fn-param',\n'fn-var',\n'fn-return',\n'while-stmt',\nundefined]\n)\n).\nfn((t) => {\n  const scope = t.params.scope;\n\n  const attr = '@const';\n  const code = `\n      ${scope === 'private-var' ? attr : ''}\n      var<private> priv_var : i32;\n\n      ${scope === 'storage-var' ? attr : ''}\n      @group(0) @binding(0)\n      var<storage> stor_var : i32;\n\n      struct A {\n        ${scope === 'struct-member' ? attr : ''}\n        a : i32,\n      }\n\n      @vertex\n      ${scope === 'fn-decl' ? attr : ''}\n      fn f(\n        ${scope === 'fn-param' ? attr : ''}\n        @location(0) b : i32,\n      ) -> ${scope === 'fn-return' ? attr : ''} @builtin(position) vec4f {\n        ${scope === 'fn-var' ? attr : ''}\n        var<function> func_v : i32;\n\n        ${scope === 'while-stmt' ? attr : ''}\n        while false {}\n\n        return vec4(1, 1, 1, 1);\n      }\n    `;\n\n  t.expectCompileResult(scope === undefined, code);\n});"],"mappings":"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","ignoreList":[]}