{"version":3,"file":"override.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","test","desc","params","u","combine","fn","t","wgsl","target","expectCompileResult","kIdCases","min","code","valid","max","neg","too_large","duplicate","testcase","case","expect","kTypeCases","bool","i32","u32","f32","f16","abs_int_conversion","abs_float_conversion","vec2_bool","vec2i","vec3u","vec4f","mat2x2f","matrix","array","struct","atomic","beforeAllSubcases","selectDeviceOrSkipTestCase","kInitCases","no_init_no_type","no_init","no_type","init_matching_type","init_mismatch_type","init_mismatch_vector","abs_int_init_convert","abs_float_init_convert","init_const_expr","init_override_expr","init_runtime_expr","const_func_init","non_const_func_init","mix_order_init"],"sources":["../../../../../src/webgpu/shader/validation/decl/override.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nValidation tests for override declarations\n`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('no_direct_recursion').\ndesc('Test that direct recursion of override declarations is rejected').\nparams((u) => u.combine('target', ['a', 'b'])).\nfn((t) => {\n  const wgsl = `\noverride a : i32 = 42;\noverride b : i32 = ${t.params.target};\n`;\n  t.expectCompileResult(t.params.target === 'a', wgsl);\n});\n\ng.test('no_indirect_recursion').\ndesc('Test that indirect recursion of override declarations is rejected').\nparams((u) => u.combine('target', ['a', 'b'])).\nfn((t) => {\n  const wgsl = `\noverride a : i32 = 42;\noverride b : i32 = c;\noverride c : i32 = ${t.params.target};\n`;\n  t.expectCompileResult(t.params.target === 'a', wgsl);\n});\n\nconst kIdCases = {\n  min: {\n    code: `@id(0) override x = 1;`,\n    valid: true\n  },\n  max: {\n    code: `@id(65535) override x = 1;`,\n    valid: true\n  },\n  neg: {\n    code: `@id(-1) override x = 1;`,\n    valid: false\n  },\n  too_large: {\n    code: `@id(65536) override x = 1;`,\n    valid: false\n  },\n  duplicate: {\n    code: `\n      @id(1) override x = 1;\n      @id(1) override y = 1;`,\n    valid: false\n  }\n};\n\ng.test('id').\ndesc('Test id attributes').\nparams((u) => u.combine('case', keysOf(kIdCases))).\nfn((t) => {\n  const testcase = kIdCases[t.params.case];\n  const code = testcase.code;\n  const expect = testcase.valid;\n  t.expectCompileResult(expect, code);\n});\n\nconst kTypeCases = {\n  bool: {\n    code: `override x : bool;`,\n    valid: true\n  },\n  i32: {\n    code: `override x : i32;`,\n    valid: true\n  },\n  u32: {\n    code: `override x : u32;`,\n    valid: true\n  },\n  f32: {\n    code: `override x : f32;`,\n    valid: true\n  },\n  f16: {\n    code: `enable f16;\\noverride x : f16;`,\n    valid: true\n  },\n  abs_int_conversion: {\n    code: `override x = 1;`,\n    valid: true\n  },\n  abs_float_conversion: {\n    code: `override x = 1.0;`,\n    valid: true\n  },\n  vec2_bool: {\n    code: `override x : vec2<bool>;`,\n    valid: false\n  },\n  vec2i: {\n    code: `override x : vec2i;`,\n    valid: false\n  },\n  vec3u: {\n    code: `override x : vec3u;`,\n    valid: false\n  },\n  vec4f: {\n    code: `override x : vec4f;`,\n    valid: false\n  },\n  mat2x2f: {\n    code: `override x : mat2x2f;`,\n    valid: false\n  },\n  matrix: {\n    code: `override x : mat4x3<f32>;`,\n    valid: false\n  },\n  array: {\n    code: `override x : array<u32, 4>;`,\n    valid: false\n  },\n  struct: {\n    code: `struct S { x : u32 }\\noverride x : S;`,\n    valid: false\n  },\n  atomic: {\n    code: `override x : atomic<u32>;`,\n    valid: false\n  }\n};\n\ng.test('type').\ndesc('Test override types').\nparams((u) => u.combine('case', keysOf(kTypeCases))).\nbeforeAllSubcases((t) => {\n  if (t.params.case === 'f16') {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  }\n}).\nfn((t) => {\n  const testcase = kTypeCases[t.params.case];\n  const code = testcase.code;\n  const expect = testcase.valid;\n  t.expectCompileResult(expect, code);\n});\n\nconst kInitCases = {\n  no_init_no_type: {\n    code: `override x;`,\n    valid: false\n  },\n  no_init: {\n    code: `override x : u32;`,\n    valid: true\n  },\n  no_type: {\n    code: `override x = 1;`,\n    valid: true\n  },\n  init_matching_type: {\n    code: `override x : u32 = 1u;`,\n    valid: true\n  },\n  init_mismatch_type: {\n    code: `override x : u32 = 1i;`,\n    valid: false\n  },\n  init_mismatch_vector: {\n    code: `override x : u32 = vec2i();`,\n    valid: false\n  },\n  abs_int_init_convert: {\n    code: `override x : f32 = 1;`,\n    valid: true\n  },\n  abs_float_init_convert: {\n    code: `override x : f32 = 1.0;`,\n    valid: true\n  },\n  init_const_expr: {\n    code: `const x = 1;\\noverride y = 2 * x;`,\n    valid: true\n  },\n  init_override_expr: {\n    code: `override x = 1;\\noverride y = x + 2;`,\n    valid: true\n  },\n  init_runtime_expr: {\n    code: `var<private> x = 2;\\noverride y = x;`,\n    valid: false\n  },\n  const_func_init: {\n    code: `override x = max(1, 2);`,\n    valid: true\n  },\n  non_const_func_init: {\n    code: `override x = foo(1);\n    fn foo(p : i32) -> i32 { return p; }`,\n    valid: false\n  },\n  mix_order_init: {\n    code: `override x = y;\n    override y : i32;`,\n    valid: true\n  }\n};\n\ng.test('initializer').\ndesc('Test override initializers').\nparams((u) => u.combine('case', keysOf(kInitCases))).\nfn((t) => {\n  const testcase = kInitCases[t.params.case];\n  const code = testcase.code;\n  const expect = testcase.valid;\n  t.expectCompileResult(expect, code);\n});\n\ng.test('function_scope').\ndesc('Test that override declarations are disallowed in functions').\nfn((t) => {\n  const code = `fn foo() { override x : u32; }`;\n  t.expectCompileResult(false, code);\n});"],"mappings":"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","ignoreList":[]}