{"version":3,"file":"all.spec.js","names":["builtin","description","makeTestGroup","keysOf","objectsToRecord","Type","elementTypeOf","kAllScalarsAndVectors","ShaderValidationTest","validateConstOrOverrideBuiltinEval","g","kArgumentTypes","test","desc","params","u","combine","fn","t","type","bool","create","kTests","valid","src","pass","alias","i32","u32","f32","f16","vec_bool","vec2_bool_implicit","vec3_bool_implicit","vec_i32","vec_u32","vec_f32","vec_f16","matrix","atomic","array","array_runtime","struct","enumerant","ptr","ptr_deref","sampler","texture","no_args","too_many_args","use_it","use","expectCompileResult","beforeAllSubcases","includes","selectDeviceOrSkipTestCase","enables","code"],"sources":["../../../../../../../src/webgpu/shader/validation/expression/call/builtin/all.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/const builtin = 'all';export const description = `\nValidation tests for the ${builtin}() builtin.\n`;\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { keysOf, objectsToRecord } from '../../../../../../common/util/data_tables.js';\nimport { Type, elementTypeOf, kAllScalarsAndVectors } from '../../../../../util/conversion.js';\nimport { ShaderValidationTest } from '../../../shader_validation_test.js';\n\nimport { validateConstOrOverrideBuiltinEval } from './const_override_validation.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kArgumentTypes = objectsToRecord(kAllScalarsAndVectors);\n\ng.test('argument_types').\ndesc(\n  `\nValidates that scalar and vector arguments are rejected by ${builtin}() if not bool or vecN<bool>\n`\n).\nparams((u) => u.combine('type', keysOf(kArgumentTypes))).\nfn((t) => {\n  const type = kArgumentTypes[t.params.type];\n  validateConstOrOverrideBuiltinEval(\n    t,\n    builtin,\n    /* expectedResult */elementTypeOf(type) === Type.bool,\n    [type.create(0)],\n    'constant',\n    /* returnType */Type.bool\n  );\n});\n\nconst kTests = {\n  valid: {\n    src: `_ = ${builtin}(true);`,\n    pass: true\n  },\n  alias: {\n    src: `_ = ${builtin}(bool_alias(true));`,\n    pass: true\n  },\n  bool: {\n    src: `_ = ${builtin}(false);`,\n    pass: true\n  },\n  i32: {\n    src: `_ = ${builtin}(1i);`,\n    pass: false\n  },\n  u32: {\n    src: `_ = ${builtin}(1u);`,\n    pass: false\n  },\n  f32: {\n    src: `_ = ${builtin}(1.0f);`,\n    pass: false\n  },\n  f16: {\n    src: `_ = ${builtin}(1.0h);`,\n    pass: false\n  },\n  vec_bool: {\n    src: `_ = ${builtin}(vec2<bool>(false, true));`,\n    pass: true\n  },\n  vec2_bool_implicit: {\n    src: `_ = ${builtin}(vec2(false, true));`,\n    pass: true\n  },\n  vec3_bool_implicit: {\n    src: `_ = ${builtin}(vec3(true));`,\n    pass: true\n  },\n  vec_i32: {\n    src: `_ = ${builtin}(vec2<i32>(1, 1));`,\n    pass: false\n  },\n  vec_u32: {\n    src: `_ = ${builtin}(vec2<u32>(1, 1));`,\n    pass: false\n  },\n  vec_f32: {\n    src: `_ = ${builtin}(vec2<f32>(1, 1));`,\n    pass: false\n  },\n  vec_f16: {\n    src: `_ = ${builtin}(vec2<f16>(1, 1));`,\n    pass: false\n  },\n  matrix: {\n    src: `_ = ${builtin}(mat2x2(1, 1, 1, 1));`,\n    pass: false\n  },\n  atomic: {\n    src: ` _ = ${builtin}(a);`,\n    pass: false\n  },\n  array: {\n    src: `var a: array<bool, 5>;\n            _ = ${builtin}(a);`,\n    pass: false\n  },\n  array_runtime: {\n    src: `_ = ${builtin}(k.arry);`,\n    pass: false\n  },\n  struct: {\n    src: `var a: A;\n            _ = ${builtin}(a);`,\n    pass: false\n  },\n  enumerant: {\n    src: `_ = ${builtin}(read_write);`,\n    pass: false\n  },\n  ptr: {\n    src: `var<function> a = true;\n            let p: ptr<function, bool> = &a;\n            _ = ${builtin}(p);`,\n    pass: false\n  },\n  ptr_deref: {\n    src: `var<function> a = true;\n            let p: ptr<function, bool> = &a;\n            _ = ${builtin}(*p);`,\n    pass: true\n  },\n  sampler: {\n    src: `_ = ${builtin}(s);`,\n    pass: false\n  },\n  texture: {\n    src: `_ = ${builtin}(t);`,\n    pass: false\n  },\n  no_args: {\n    src: `_ = ${builtin}();`,\n    pass: false\n  },\n  too_many_args: {\n    src: `_ = ${builtin}(true, true);`,\n    pass: false\n  }\n};\n\ng.test('must_use').\ndesc(`Result of ${builtin} must be used`).\nparams((u) => u.combine('use', [true, false])).\nfn((t) => {\n  const use_it = t.params.use ? '_ = ' : '';\n  t.expectCompileResult(t.params.use, `fn f() { ${use_it}${builtin}(true); }`);\n});\n\ng.test('arguments').\ndesc(`Test that ${builtin} is validated correctly.`).\nparams((u) => u.combine('test', keysOf(kTests))).\nbeforeAllSubcases((t) => {\n  if (t.params.test.includes('f16')) {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  }\n}).\nfn((t) => {\n  const src = kTests[t.params.test].src;\n  const enables = t.params.test.includes('f16') ? 'enable f16;' : '';\n  const code = `\n  ${enables}\n  alias bool_alias = bool;\n\n  @group(0) @binding(0) var s: sampler;\n  @group(0) @binding(1) var t: texture_2d<f32>;\n\n  var<workgroup> a: atomic<u32>;\n\n  struct A {\n    i: bool,\n  }\n  struct B {\n    arry: array<u32>,\n  }\n  @group(0) @binding(3) var<storage> k: B;\n\n  @vertex\n  fn main() -> @builtin(position) vec4<f32> {\n    ${src}\n    return vec4<f32>(.4, .2, .3, .1);\n  }`;\n  t.expectCompileResult(kTests[t.params.test].pass, code);\n});"],"mappings":"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","ignoreList":[]}