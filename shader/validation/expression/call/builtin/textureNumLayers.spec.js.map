{"version":3,"file":"textureNumLayers.spec.js","names":["builtin","description","makeTestGroup","keysOf","objectsToRecord","kAllTextureFormats","kTextureFormatInfo","Type","kAllScalarsAndVectors","isConvertible","stringToType","ShaderValidationTest","getNonStorageTextureTypeWGSL","kNonStorageTextureTypeInfo","kTestTextureTypes","kTextureNumLayersTextureTypesForNonStorageTextures","kTextureNumLayersTextureTypesForStorageTextures","kValuesTypes","g","test","specURL","desc","params","u","combine","beginSubcases","expand","t","textureType","texelTypes","map","v","toString","fn","returnType","texelType","returnVarType","varWGSL","texelArgType","textureWGSL","code","expectSuccess","u32","expectCompileResult","filter","format","color","storage","skipIfTextureFormatNotUsableAsStorageTexture","testTextureType","includes","use"],"sources":["../../../../../../../src/webgpu/shader/validation/expression/call/builtin/textureNumLayers.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/const builtin = 'textureNumLayers';export const description = `\nValidation tests for the ${builtin}() builtin.\n\n* test textureNumLayers returns the correct type\n* test textureNumLayers doesn't work with texture types it's not supposed to\n`;\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { keysOf, objectsToRecord } from '../../../../../../common/util/data_tables.js';\nimport { kAllTextureFormats, kTextureFormatInfo } from '../../../../../format_info.js';\nimport {\n  Type,\n  kAllScalarsAndVectors,\n  isConvertible,\n  stringToType } from\n'../../../../../util/conversion.js';\nimport { ShaderValidationTest } from '../../../shader_validation_test.js';\n\nimport {\n  getNonStorageTextureTypeWGSL,\n  kNonStorageTextureTypeInfo,\n  kTestTextureTypes } from\n'./shader_builtin_utils.js';\n\nconst kTextureNumLayersTextureTypesForNonStorageTextures = [\n'texture_2d_array',\n'texture_cube_array',\n'texture_depth_2d_array',\n'texture_depth_cube_array'];\n\n\nconst kTextureNumLayersTextureTypesForStorageTextures = ['texture_storage_2d_array'];\n\nconst kValuesTypes = objectsToRecord(kAllScalarsAndVectors);\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('return_type,non_storage').\nspecURL('https://gpuweb.github.io/gpuweb/wgsl/#texturenumlayers').\ndesc(\n  `\nValidates the return type of ${builtin} is the expected type.\n`\n).\nparams((u) =>\nu.\ncombine('returnType', keysOf(kValuesTypes)).\ncombine('textureType', kTextureNumLayersTextureTypesForNonStorageTextures).\nbeginSubcases().\nexpand('texelType', (t) =>\nkNonStorageTextureTypeInfo[t.textureType].texelTypes.map((v) => v.toString())\n)\n).\nfn((t) => {\n  const { returnType, textureType, texelType } = t.params;\n  const returnVarType = kValuesTypes[returnType];\n\n  const varWGSL = returnVarType.toString();\n  const texelArgType = stringToType(texelType);\n  const textureWGSL = getNonStorageTextureTypeWGSL(textureType, texelArgType);\n\n  const code = `\n@group(0) @binding(0) var t: ${textureWGSL};\n@fragment fn fs() -> @location(0) vec4f {\n  let v: ${varWGSL} = textureNumLayers(t);\n  return vec4f(0);\n}\n`;\n  const expectSuccess = isConvertible(Type.u32, returnVarType);\n  t.expectCompileResult(expectSuccess, code);\n});\n\ng.test('return_type,storage').\nspecURL('https://gpuweb.github.io/gpuweb/wgsl/#texturenumlayers').\ndesc(\n  `\nValidates the return type of ${builtin} is the expected type.\n`\n).\nparams((u) =>\nu.\ncombine('returnType', keysOf(kValuesTypes)).\ncombine('textureType', kTextureNumLayersTextureTypesForStorageTextures).\nbeginSubcases().\ncombine('format', kAllTextureFormats)\n// filter to only storage texture formats.\n.filter((t) => !!kTextureFormatInfo[t.format].color?.storage)\n).\nfn((t) => {\n  const { returnType, textureType, format } = t.params;\n  t.skipIfTextureFormatNotUsableAsStorageTexture(format);\n\n  const returnVarType = kValuesTypes[returnType];\n\n  const varWGSL = returnVarType.toString();\n\n  const code = `\n@group(0) @binding(0) var t: ${textureType}<${format}, read>;\n@fragment fn fs() -> @location(0) vec4f {\n  let v: ${varWGSL} = textureNumLayers(t);\n  return vec4f(0);\n}\n`;\n  const expectSuccess = isConvertible(Type.u32, returnVarType);\n  t.expectCompileResult(expectSuccess, code);\n});\n\ng.test('texture_type').\nspecURL('https://gpuweb.github.io/gpuweb/wgsl/#texturenumlayers').\ndesc(\n  `\nValidates that incompatible texture types don't work with ${builtin}\n`\n).\nparams((u) => u.combine('testTextureType', kTestTextureTypes)).\nfn((t) => {\n  const { testTextureType } = t.params;\n  const code = `\n@group(0) @binding(1) var t: ${testTextureType};\n@fragment fn fs() -> @location(0) vec4f {\n  let v = textureNumLayers(t);\n  return vec4f(0);\n}\n`;\n\n  const expectSuccess = testTextureType.includes('array');\n\n  t.expectCompileResult(expectSuccess, code);\n});\n\ng.test('must_use').\ndesc('Tests that the result must be used').\nparams((u) => u.combine('use', [true, false])).\nfn((t) => {\n  const code = `\n    @group(0) @binding(0) var t : texture_2d_array<f32>;\n    fn foo() {\n      ${t.params.use ? '_ =' : ''} textureNumLayers(t);\n    }`;\n  t.expectCompileResult(t.params.use, code);\n});"],"mappings":"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","ignoreList":[]}