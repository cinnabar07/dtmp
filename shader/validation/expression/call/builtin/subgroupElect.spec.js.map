{"version":3,"file":"subgroupElect.spec.js","names":["description","makeTestGroup","keysOf","objectsToRecord","Type","elementTypeOf","kAllScalarsAndVectors","ShaderValidationTest","g","test","desc","params","u","combine","beforeAllSubcases","t","selectDeviceOrSkipTestCase","fn","wgsl","enable","expectCompileResult","kStages","constant","override","runtime","code","stage","must_use","kTypes","features","type","requiresF16","push","enables","create","filter","eleType","abstractInt","abstractFloat","toString","bool","compute","fragment","vertex","entry"],"sources":["../../../../../../../src/webgpu/shader/validation/expression/call/builtin/subgroupElect.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nValidation tests for subgroupElect.\n`;import { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { keysOf, objectsToRecord } from '../../../../../../common/util/data_tables.js';\nimport { Type, elementTypeOf, kAllScalarsAndVectors } from '../../../../../util/conversion.js';\nimport { ShaderValidationTest } from '../../../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('requires_subgroups').\ndesc('Validates that the subgroups feature is required').\nparams((u) => u.combine('enable', [false, true])).\nbeforeAllSubcases((t) => {\n  t.selectDeviceOrSkipTestCase('subgroups');\n}).\nfn((t) => {\n  const wgsl = `\n${t.params.enable ? 'enable subgroups;' : ''}\nfn foo() {\n  _ = subgroupElect();\n}`;\n\n  t.expectCompileResult(t.params.enable, wgsl);\n});\n\nconst kStages = {\n  constant: `\nenable subgroups;\n@compute @workgroup_size(16)\nfn main() {\n  const x = subgroupElect();\n}`,\n  override: `\nenable subgroups\noverride o = select(0, 1, subgroupElect());`,\n  runtime: `\nenable subgroups;\n@compute @workgroup_size(16)\nfn main() {\n  let x = subgroupElect();\n}`\n};\n\ng.test('early_eval').\ndesc('Ensures the builtin is not able to be compile time evaluated').\nparams((u) => u.combine('stage', keysOf(kStages))).\nbeforeAllSubcases((t) => {\n  t.selectDeviceOrSkipTestCase('subgroups');\n}).\nfn((t) => {\n  const code = kStages[t.params.stage];\n  t.expectCompileResult(t.params.stage === 'runtime', code);\n});\n\ng.test('must_use').\ndesc('Tests that the builtin has the @must_use attribute').\nparams((u) => u.combine('must_use', [true, false])).\nbeforeAllSubcases((t) => {\n  t.selectDeviceOrSkipTestCase('subgroups');\n}).\nfn((t) => {\n  const wgsl = `\nenable subgroups;\n@compute @workgroup_size(16)\nfn main() {\n  ${t.params.must_use ? '_ = ' : ''}subgroupElect();\n}`;\n\n  t.expectCompileResult(t.params.must_use, wgsl);\n});\n\nconst kTypes = objectsToRecord(kAllScalarsAndVectors);\n\ng.test('data_type').\ndesc('Validates there are no valid data parameters').\nparams((u) => u.combine('type', keysOf(kTypes))).\nbeforeAllSubcases((t) => {\n  const features = ['subgroups'];\n  const type = kTypes[t.params.type];\n  if (type.requiresF16()) {\n    features.push('shader-f16');\n    features.push('subgroups-f16');\n  }\n  t.selectDeviceOrSkipTestCase(features);\n}).\nfn((t) => {\n  const type = kTypes[t.params.type];\n  let enables = `enable subgroups;\\n`;\n  if (type.requiresF16()) {\n    enables += `enable f16;\\nenable subgroups_f16;`;\n  }\n  const wgsl = `\n${enables}\n@compute @workgroup_size(1)\nfn main() {\n  _ = subgroupElect(${type.create(0).wgsl()});\n}`;\n\n  t.expectCompileResult(false, wgsl);\n});\n\ng.test('return_type').\ndesc('Validates return type').\nparams((u) =>\nu.combine('type', keysOf(kTypes)).filter((t) => {\n  const type = kTypes[t.type];\n  const eleType = elementTypeOf(type);\n  return eleType !== Type.abstractInt && eleType !== Type.abstractFloat;\n})\n).\nbeforeAllSubcases((t) => {\n  const features = ['subgroups'];\n  const type = kTypes[t.params.type];\n  if (type.requiresF16()) {\n    features.push('shader-f16');\n    features.push('subgroups-f16');\n  }\n  t.selectDeviceOrSkipTestCase(features);\n}).\nfn((t) => {\n  const type = kTypes[t.params.type];\n  let enables = `enable subgroups;\\n`;\n  if (type.requiresF16()) {\n    enables += `enable f16;\\nenable subgroups_f16;`;\n  }\n  const wgsl = `\n${enables}\n@compute @workgroup_size(1)\nfn main() {\n  let res : ${type.toString()} = subgroupElect();\n}`;\n\n  t.expectCompileResult(type === Type.bool, wgsl);\n});\n\ng.test('stage').\ndesc('validates builtin is only usable in the correct stages').\nparams((u) => u.combine('stage', ['compute', 'fragment', 'vertex'])).\nbeforeAllSubcases((t) => {\n  t.selectDeviceOrSkipTestCase('subgroups');\n}).\nfn((t) => {\n  const compute = `\n@compute @workgroup_size(1)\nfn main() {\n  foo();\n}`;\n\n  const fragment = `\n@fragment\nfn main() {\n  foo();\n}`;\n\n  const vertex = `\n@vertex\nfn main() -> @builtin(position) vec4f {\n  foo();\n  return vec4f();\n}`;\n\n  const entry = { compute, fragment, vertex }[t.params.stage];\n  const wgsl = `\nenable subgroups;\nfn foo() {\n  _ = subgroupElect();\n}\n\n${entry}\n`;\n\n  t.expectCompileResult(t.params.stage !== 'vertex', wgsl);\n});"],"mappings":"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","ignoreList":[]}