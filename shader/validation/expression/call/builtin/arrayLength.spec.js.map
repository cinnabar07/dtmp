{"version":3,"file":"arrayLength.spec.js","names":["description","makeTestGroup","ShaderValidationTest","g","test","specURL","desc","fn","t","code","expectCompileResult","atomic_types","map","j","vec_types","i","reduce","a","c","concat","f32_matrix_types","f16_matrix_types","params","u","combine","beforeAllSubcases","type","includes","selectDeviceOrSkipTestCase","mode","use"],"sources":["../../../../../../../src/webgpu/shader/validation/expression/call/builtin/arrayLength.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nValidation tests for arrayLength builtins.\n`;import { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { ShaderValidationTest } from '../../../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('bool_type').\nspecURL('https://www.w3.org/TR/WGSL/#arrayLength-builtin').\ndesc(\n  `\narrayLength accepts only runtime-sized arrays\n`\n).\nfn((t) => {\n  const code = `\n@compute @workgroup_size(1)\nfn main() {\n  var b = true;\n  _ = arrayLength(&b);\n}`;\n\n  t.expectCompileResult(false, code);\n});\n\nconst atomic_types = ['u32', 'i32'].map((j) => `atomic<${j}>`);\nconst vec_types = [2, 3, 4].\nmap((i) => ['i32', 'u32', 'f32', 'f16'].map((j) => `vec${i}<${j}>`)).\nreduce((a, c) => a.concat(c), []);\nconst f32_matrix_types = [2, 3, 4].\nmap((i) => [2, 3, 4].map((j) => `mat${i}x${j}f`)).\nreduce((a, c) => a.concat(c), []);\nconst f16_matrix_types = [2, 3, 4].\nmap((i) => [2, 3, 4].map((j) => `mat${i}x${j}<f16>`)).\nreduce((a, c) => a.concat(c), []);\n\ng.test('type').\nspecURL('https://www.w3.org/TR/WGSL/#arrayLength-builtin').\ndesc(\n  `\narrayLength accepts only runtime-sized arrays\n`\n).\nparams((u) =>\nu.combine('type', [\n'i32',\n'u32',\n'f32',\n'f16',\n...f32_matrix_types,\n...f16_matrix_types,\n...vec_types,\n...atomic_types,\n'T',\n'array<i32, 2>',\n'array<i32>']\n)\n).\nbeforeAllSubcases((t) => {\n  if (t.params.type.includes('f16')) {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  }\n}).\nfn((t) => {\n  const code = `\nstruct T {\n  b: i32,\n}\nstruct S {\n  ary: ${t.params.type}\n}\n\n@group(0) @binding(0) var<storage, read_write> items: S;\n\n@compute @workgroup_size(1)\nfn main() {\n  _ = arrayLength(&items.ary);\n}`;\n\n  t.expectCompileResult(t.params.type === 'array<i32>', code);\n});\n\n// Note, the `write` case actually fails because you can't declare a storage buffer of\n// access_mode `write`.\ng.test('access_mode').\nspecURL('https://www.w3.org/TR/WGSL/#arrayLength-builtin').\ndesc(\n  `\narrayLength runtime-sized array must have an access_mode of read or read_write\n`\n).\nparams((u) => u.combine('mode', ['read', 'read_write', 'write'])).\nfn((t) => {\n  const code = `\nstruct S {\n  ary: array<i32>,\n}\n\n@group(0) @binding(0) var<storage, ${t.params.mode}> items: S;\n\n@compute @workgroup_size(1)\nfn main() {\n  _ = arrayLength(&items.ary);\n}`;\n\n  t.expectCompileResult(t.params.mode !== 'write', code);\n});\n\ng.test('must_use').\ndesc('Test that the result must be used').\nparams((u) => u.combine('use', [true, false])).\nfn((t) => {\n  const code = `\n    @group(0) @binding(0) var<storage> v : array<u32>;\n    fn foo() {\n      ${t.params.use ? '_ =' : ''} arrayLength(&v);\n    }`;\n  t.expectCompileResult(t.params.use, code);\n});"],"mappings":";;IAAA;AACA;AACA,GAAG,OAAO,MAAMA,WAAW,GAAG;AAC9B;AACA,CAAC,CAAC,SAASC,aAAa,QAAQ,kDAAkD,CAClF,SAASC,oBAAoB,QAAQ,oCAAoC;AAEzE,OAAO,MAAMC,CAAC,GAAGF,aAAa,CAACC,oBAAoB,CAAC;;AAEpDC,CAAC,CAACC,IAAI,CAAC,WAAW,CAAC;AACnBC,OAAO,CAAC,iDAAiD,CAAC;AAC1DC,IAAI;EACF;AACF;AACA;AACA,CAAC;AACDC,EAAE,CAAC,CAACC,CAAC,KAAK;EACR,MAAMC,IAAI,GAAG;AACf;AACA;AACA;AACA;AACA,EAAE;;EAEAD,CAAC,CAACE,mBAAmB,CAAC,KAAK,EAAED,IAAI,CAAC;AACpC,CAAC,CAAC;;AAEF,MAAME,YAAY,GAAG,CAAC,KAAK,EAAE,KAAK,CAAC,CAACC,GAAG,CAAC,CAACC,CAAC,KAAK,UAAUA,CAAC,GAAG,CAAC;AAC9D,MAAMC,SAAS,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAC3BF,GAAG,CAAC,CAACG,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAACH,GAAG,CAAC,CAACC,CAAC,KAAK,MAAME,CAAC,IAAIF,CAAC,GAAG,CAAC,CAAC;AACpEG,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACE,MAAM,CAACD,CAAC,CAAC,EAAE,EAAE,CAAC;AACjC,MAAME,gBAAgB,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAClCR,GAAG,CAAC,CAACG,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAACH,GAAG,CAAC,CAACC,CAAC,KAAK,MAAME,CAAC,IAAIF,CAAC,GAAG,CAAC,CAAC;AACjDG,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACE,MAAM,CAACD,CAAC,CAAC,EAAE,EAAE,CAAC;AACjC,MAAMG,gBAAgB,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAClCT,GAAG,CAAC,CAACG,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAACH,GAAG,CAAC,CAACC,CAAC,KAAK,MAAME,CAAC,IAAIF,CAAC,OAAO,CAAC,CAAC;AACrDG,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACE,MAAM,CAACD,CAAC,CAAC,EAAE,EAAE,CAAC;;AAEjCf,CAAC,CAACC,IAAI,CAAC,MAAM,CAAC;AACdC,OAAO,CAAC,iDAAiD,CAAC;AAC1DC,IAAI;EACF;AACF;AACA;AACA,CAAC;AACDgB,MAAM,CAAC,CAACC,CAAC;AACTA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAE;AAClB,KAAK;AACL,KAAK;AACL,KAAK;AACL,KAAK;AACL,GAAGJ,gBAAgB;AACnB,GAAGC,gBAAgB;AACnB,GAAGP,SAAS;AACZ,GAAGH,YAAY;AACf,GAAG;AACH,eAAe;AACf,YAAY;AACZ;AACA,CAAC;AACDc,iBAAiB,CAAC,CAACjB,CAAC,KAAK;EACvB,IAAIA,CAAC,CAACc,MAAM,CAACI,IAAI,CAACC,QAAQ,CAAC,KAAK,CAAC,EAAE;IACjCnB,CAAC,CAACoB,0BAA0B,CAAC,YAAY,CAAC;EAC5C;AACF,CAAC,CAAC;AACFrB,EAAE,CAAC,CAACC,CAAC,KAAK;EACR,MAAMC,IAAI,GAAG;AACf;AACA;AACA;AACA;AACA,SAASD,CAAC,CAACc,MAAM,CAACI,IAAI;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;EAEAlB,CAAC,CAACE,mBAAmB,CAACF,CAAC,CAACc,MAAM,CAACI,IAAI,KAAK,YAAY,EAAEjB,IAAI,CAAC;AAC7D,CAAC,CAAC;;AAEF;AACA;AACAN,CAAC,CAACC,IAAI,CAAC,aAAa,CAAC;AACrBC,OAAO,CAAC,iDAAiD,CAAC;AAC1DC,IAAI;EACF;AACF;AACA;AACA,CAAC;AACDgB,MAAM,CAAC,CAACC,CAAC,KAAKA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAE,CAAC,MAAM,EAAE,YAAY,EAAE,OAAO,CAAC,CAAC,CAAC;AACjEjB,EAAE,CAAC,CAACC,CAAC,KAAK;EACR,MAAMC,IAAI,GAAG;AACf;AACA;AACA;AACA;AACA,qCAAqCD,CAAC,CAACc,MAAM,CAACO,IAAI;AAClD;AACA;AACA;AACA;AACA,EAAE;;EAEArB,CAAC,CAACE,mBAAmB,CAACF,CAAC,CAACc,MAAM,CAACO,IAAI,KAAK,OAAO,EAAEpB,IAAI,CAAC;AACxD,CAAC,CAAC;;AAEFN,CAAC,CAACC,IAAI,CAAC,UAAU,CAAC;AAClBE,IAAI,CAAC,mCAAmC,CAAC;AACzCgB,MAAM,CAAC,CAACC,CAAC,KAAKA,CAAC,CAACC,OAAO,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;AAC9CjB,EAAE,CAAC,CAACC,CAAC,KAAK;EACR,MAAMC,IAAI,GAAG;AACf;AACA;AACA,QAAQD,CAAC,CAACc,MAAM,CAACQ,GAAG,GAAG,KAAK,GAAG,EAAE;AACjC,MAAM;EACJtB,CAAC,CAACE,mBAAmB,CAACF,CAAC,CAACc,MAAM,CAACQ,GAAG,EAAErB,IAAI,CAAC;AAC3C,CAAC,CAAC","ignoreList":[]}