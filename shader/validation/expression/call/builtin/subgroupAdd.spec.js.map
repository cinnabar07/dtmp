{"version":3,"file":"subgroupAdd.spec.js","names":["description","makeTestGroup","keysOf","objectsToRecord","Type","elementTypeOf","kAllScalarsAndVectors","ShaderValidationTest","g","kBuiltins","kStages","constant","builtin","override","runtime","test","desc","params","u","combine","beginSubcases","beforeAllSubcases","t","selectDeviceOrSkipTestCase","fn","code","stage","expectCompileResult","wgsl","must_use","kArgumentTypes","features","type","requiresF16","push","enables","create","bool","filter","retType","retEleTy","dataType","dataEleTy","abstractInt","abstractFloat","toString","expect","compute","fragment","vertex","entry","kInvalidTypeCases","array_u32","array_f32","struct_s","struct_t","ptr_func","ptr_priv","frexp_ret","val","case"],"sources":["../../../../../../../src/webgpu/shader/validation/expression/call/builtin/subgroupAdd.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nValidation tests for subgroupAdd and subgroupExclusiveAdd\n`;import { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { keysOf, objectsToRecord } from '../../../../../../common/util/data_tables.js';\nimport { Type, elementTypeOf, kAllScalarsAndVectors } from '../../../../../util/conversion.js';\nimport { ShaderValidationTest } from '../../../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kBuiltins = ['subgroupAdd', 'subgroupExclusiveAdd', 'subgroupInclusiveAdd'];\n\nconst kStages = {\n  constant: (builtin) => {\n    return `\nenable subgroups;\n@compute @workgroup_size(16)\nfn main() {\n  const x = ${builtin}(0);\n}`;\n  },\n  override: (builtin) => {\n    return `\nenable subgroups;\noverride o = ${builtin}(0);`;\n  },\n  runtime: (builtin) => {\n    return `\nenable subgroups;\n@compute @workgroup_size(16)\nfn main() {\n  let x = ${builtin}(0);\n}`;\n  }\n};\n\ng.test('early_eval').\ndesc('Ensures the builtin is not able to be compile time evaluated').\nparams((u) => u.combine('stage', keysOf(kStages)).beginSubcases().combine('builtin', kBuiltins)).\nbeforeAllSubcases((t) => {\n  t.selectDeviceOrSkipTestCase('subgroups');\n}).\nfn((t) => {\n  const code = kStages[t.params.stage](t.params.builtin);\n  t.expectCompileResult(t.params.stage === 'runtime', code);\n});\n\ng.test('must_use').\ndesc('Tests that the builtin has the @must_use attribute').\nparams((u) =>\nu.\ncombine('must_use', [true, false]).\nbeginSubcases().\ncombine('builtin', kBuiltins)\n).\nbeforeAllSubcases((t) => {\n  t.selectDeviceOrSkipTestCase('subgroups');\n}).\nfn((t) => {\n  const wgsl = `\nenable subgroups;\n@compute @workgroup_size(16)\nfn main() {\n  ${t.params.must_use ? '_ = ' : ''}${t.params.builtin}(0);\n}`;\n\n  t.expectCompileResult(t.params.must_use, wgsl);\n});\n\nconst kArgumentTypes = objectsToRecord(kAllScalarsAndVectors);\n\ng.test('data_type').\ndesc('Validates data parameter type').\nparams((u) =>\nu.combine('type', keysOf(kArgumentTypes)).beginSubcases().combine('builtin', kBuiltins)\n).\nbeforeAllSubcases((t) => {\n  const features = ['subgroups'];\n  const type = kArgumentTypes[t.params.type];\n  if (type.requiresF16()) {\n    features.push('subgroups-f16');\n    features.push('shader-f16');\n  }\n  t.selectDeviceOrSkipTestCase(features);\n}).\nfn((t) => {\n  const type = kArgumentTypes[t.params.type];\n  let enables = `enable subgroups;\\n`;\n  if (type.requiresF16()) {\n    enables += `enable subgroups_f16;\\nenable f16;`;\n  }\n  const wgsl = `\n${enables}\n@compute @workgroup_size(1)\nfn main() {\n  _ = ${t.params.builtin}(${type.create(0).wgsl()});\n}`;\n\n  t.expectCompileResult(elementTypeOf(type) !== Type.bool, wgsl);\n});\n\ng.test('return_type').\ndesc('Validates data parameter type').\nparams((u) =>\nu.\ncombine('dataType', keysOf(kArgumentTypes)).\ncombine('retType', keysOf(kArgumentTypes)).\nfilter((t) => {\n  const retType = kArgumentTypes[t.retType];\n  const retEleTy = elementTypeOf(retType);\n  const dataType = kArgumentTypes[t.dataType];\n  const dataEleTy = elementTypeOf(dataType);\n  return (\n    retEleTy !== Type.abstractInt &&\n    retEleTy !== Type.abstractFloat &&\n    dataEleTy !== Type.abstractInt &&\n    dataEleTy !== Type.abstractFloat);\n\n}).\nbeginSubcases().\ncombine('builtin', kBuiltins)\n).\nbeforeAllSubcases((t) => {\n  const features = ['subgroups'];\n  const dataType = kArgumentTypes[t.params.dataType];\n  const retType = kArgumentTypes[t.params.retType];\n  if (dataType.requiresF16() || retType.requiresF16()) {\n    features.push('subgroups-f16');\n    features.push('shader-f16');\n  }\n  t.selectDeviceOrSkipTestCase(features);\n}).\nfn((t) => {\n  const dataType = kArgumentTypes[t.params.dataType];\n  const retType = kArgumentTypes[t.params.retType];\n  let enables = `enable subgroups;\\n`;\n  if (dataType.requiresF16() || retType.requiresF16()) {\n    enables += `enable subgroups_f16;\\nenable f16;`;\n  }\n  const wgsl = `\n${enables}\n@compute @workgroup_size(1)\nfn main() {\n  let res : ${retType.toString()} = ${t.params.builtin}(${dataType.create(0).wgsl()});\n}`;\n\n  const expect = elementTypeOf(dataType) !== Type.bool && dataType === retType;\n  t.expectCompileResult(expect, wgsl);\n});\n\ng.test('stage').\ndesc('Validates it is only usable in correct stage').\nparams((u) =>\nu.\ncombine('stage', ['compute', 'fragment', 'vertex']).\nbeginSubcases().\ncombine('builtin', kBuiltins)\n).\nbeforeAllSubcases((t) => {\n  t.selectDeviceOrSkipTestCase('subgroups');\n}).\nfn((t) => {\n  const compute = `\n@compute @workgroup_size(1)\nfn main() {\n  foo();\n}`;\n\n  const fragment = `\n@fragment\nfn main() {\n  foo();\n}`;\n\n  const vertex = `\n@vertex\nfn main() -> @builtin(position) vec4f {\n  foo();\n  return vec4f();\n}`;\n\n  const entry = { compute, fragment, vertex }[t.params.stage];\n  const wgsl = `\nenable subgroups;\nfn foo() {\n  _ = ${t.params.builtin}(0);\n}\n\n${entry}\n`;\n\n  t.expectCompileResult(t.params.stage !== 'vertex', wgsl);\n});\n\nconst kInvalidTypeCases = {\n  array_u32: `array(1u,2u,3u)`,\n  array_f32: `array<f32, 4>()`,\n  struct_s: `S()`,\n  struct_t: `T(1, 1)`,\n  ptr_func: `&func_var`,\n  ptr_priv: `&priv_var`,\n  frexp_ret: `frexp(0)`\n};\n\ng.test('invalid_types').\ndesc('Tests that invalid non-plain types are rejected').\nparams((u) =>\nu.combine('case', keysOf(kInvalidTypeCases)).beginSubcases().combine('builtin', kBuiltins)\n).\nbeforeAllSubcases((t) => {\n  t.selectDeviceOrSkipTestCase('subgroups');\n}).\nfn((t) => {\n  const val = kInvalidTypeCases[t.params.case];\n  const wgsl = `\nenable subgroups;\n\nstruct S {\n  x : u32\n}\n\nstruct T {\n  a : f32,\n  b : u32,\n}\n\nvar<private> priv_var : f32;\nfn foo() {\n  var func_var : vec4u;\n  _ = ${t.params.builtin}(${val});\n}`;\n\n  t.expectCompileResult(false, wgsl);\n});"],"mappings":";;IAAA;AACA;AACA,GAAG,OAAO,MAAMA,WAAW,GAAG;AAC9B;AACA,CAAC,CAAC,SAASC,aAAa,QAAQ,kDAAkD,CAClF,SAASC,MAAM,EAAEC,eAAe,QAAQ,8CAA8C,CACtF,SAASC,IAAI,EAAEC,aAAa,EAAEC,qBAAqB,QAAQ,mCAAmC;AAC9F,SAASC,oBAAoB,QAAQ,oCAAoC;;AAEzE,OAAO,MAAMC,CAAC,GAAGP,aAAa,CAACM,oBAAoB,CAAC;;AAEpD,MAAME,SAAS,GAAG,CAAC,aAAa,EAAE,sBAAsB,EAAE,sBAAsB,CAAC;;AAEjF,MAAMC,OAAO,GAAG;EACdC,QAAQ,EAAEA,CAACC,OAAO,KAAK;IACrB,OAAO;AACX;AACA;AACA;AACA,cAAcA,OAAO;AACrB,EAAE;EACA,CAAC;EACDC,QAAQ,EAAEA,CAACD,OAAO,KAAK;IACrB,OAAO;AACX;AACA,eAAeA,OAAO,MAAM;EAC1B,CAAC;EACDE,OAAO,EAAEA,CAACF,OAAO,KAAK;IACpB,OAAO;AACX;AACA;AACA;AACA,YAAYA,OAAO;AACnB,EAAE;EACA;AACF,CAAC;;AAEDJ,CAAC,CAACO,IAAI,CAAC,YAAY,CAAC;AACpBC,IAAI,CAAC,8DAA8D,CAAC;AACpEC,MAAM,CAAC,CAACC,CAAC,KAAKA,CAAC,CAACC,OAAO,CAAC,OAAO,EAAEjB,MAAM,CAACQ,OAAO,CAAC,CAAC,CAACU,aAAa,CAAC,CAAC,CAACD,OAAO,CAAC,SAAS,EAAEV,SAAS,CAAC,CAAC;AAChGY,iBAAiB,CAAC,CAACC,CAAC,KAAK;EACvBA,CAAC,CAACC,0BAA0B,CAAC,WAAW,CAAC;AAC3C,CAAC,CAAC;AACFC,EAAE,CAAC,CAACF,CAAC,KAAK;EACR,MAAMG,IAAI,GAAGf,OAAO,CAACY,CAAC,CAACL,MAAM,CAACS,KAAK,CAAC,CAACJ,CAAC,CAACL,MAAM,CAACL,OAAO,CAAC;EACtDU,CAAC,CAACK,mBAAmB,CAACL,CAAC,CAACL,MAAM,CAACS,KAAK,KAAK,SAAS,EAAED,IAAI,CAAC;AAC3D,CAAC,CAAC;;AAEFjB,CAAC,CAACO,IAAI,CAAC,UAAU,CAAC;AAClBC,IAAI,CAAC,oDAAoD,CAAC;AAC1DC,MAAM,CAAC,CAACC,CAAC;AACTA,CAAC;AACDC,OAAO,CAAC,UAAU,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;AAClCC,aAAa,CAAC,CAAC;AACfD,OAAO,CAAC,SAAS,EAAEV,SAAS;AAC5B,CAAC;AACDY,iBAAiB,CAAC,CAACC,CAAC,KAAK;EACvBA,CAAC,CAACC,0BAA0B,CAAC,WAAW,CAAC;AAC3C,CAAC,CAAC;AACFC,EAAE,CAAC,CAACF,CAAC,KAAK;EACR,MAAMM,IAAI,GAAG;AACf;AACA;AACA;AACA,IAAIN,CAAC,CAACL,MAAM,CAACY,QAAQ,GAAG,MAAM,GAAG,EAAE,GAAGP,CAAC,CAACL,MAAM,CAACL,OAAO;AACtD,EAAE;;EAEAU,CAAC,CAACK,mBAAmB,CAACL,CAAC,CAACL,MAAM,CAACY,QAAQ,EAAED,IAAI,CAAC;AAChD,CAAC,CAAC;;AAEF,MAAME,cAAc,GAAG3B,eAAe,CAACG,qBAAqB,CAAC;;AAE7DE,CAAC,CAACO,IAAI,CAAC,WAAW,CAAC;AACnBC,IAAI,CAAC,+BAA+B,CAAC;AACrCC,MAAM,CAAC,CAACC,CAAC;AACTA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAEjB,MAAM,CAAC4B,cAAc,CAAC,CAAC,CAACV,aAAa,CAAC,CAAC,CAACD,OAAO,CAAC,SAAS,EAAEV,SAAS;AACtF,CAAC;AACDY,iBAAiB,CAAC,CAACC,CAAC,KAAK;EACvB,MAAMS,QAAQ,GAAG,CAAC,WAAW,CAAC;EAC9B,MAAMC,IAAI,GAAGF,cAAc,CAACR,CAAC,CAACL,MAAM,CAACe,IAAI,CAAC;EAC1C,IAAIA,IAAI,CAACC,WAAW,CAAC,CAAC,EAAE;IACtBF,QAAQ,CAACG,IAAI,CAAC,eAAe,CAAC;IAC9BH,QAAQ,CAACG,IAAI,CAAC,YAAY,CAAC;EAC7B;EACAZ,CAAC,CAACC,0BAA0B,CAACQ,QAAQ,CAAC;AACxC,CAAC,CAAC;AACFP,EAAE,CAAC,CAACF,CAAC,KAAK;EACR,MAAMU,IAAI,GAAGF,cAAc,CAACR,CAAC,CAACL,MAAM,CAACe,IAAI,CAAC;EAC1C,IAAIG,OAAO,GAAG,qBAAqB;EACnC,IAAIH,IAAI,CAACC,WAAW,CAAC,CAAC,EAAE;IACtBE,OAAO,IAAI,oCAAoC;EACjD;EACA,MAAMP,IAAI,GAAG;AACf,EAAEO,OAAO;AACT;AACA;AACA,QAAQb,CAAC,CAACL,MAAM,CAACL,OAAO,IAAIoB,IAAI,CAACI,MAAM,CAAC,CAAC,CAAC,CAACR,IAAI,CAAC,CAAC;AACjD,EAAE;;EAEAN,CAAC,CAACK,mBAAmB,CAACtB,aAAa,CAAC2B,IAAI,CAAC,KAAK5B,IAAI,CAACiC,IAAI,EAAET,IAAI,CAAC;AAChE,CAAC,CAAC;;AAEFpB,CAAC,CAACO,IAAI,CAAC,aAAa,CAAC;AACrBC,IAAI,CAAC,+BAA+B,CAAC;AACrCC,MAAM,CAAC,CAACC,CAAC;AACTA,CAAC;AACDC,OAAO,CAAC,UAAU,EAAEjB,MAAM,CAAC4B,cAAc,CAAC,CAAC;AAC3CX,OAAO,CAAC,SAAS,EAAEjB,MAAM,CAAC4B,cAAc,CAAC,CAAC;AAC1CQ,MAAM,CAAC,CAAChB,CAAC,KAAK;EACZ,MAAMiB,OAAO,GAAGT,cAAc,CAACR,CAAC,CAACiB,OAAO,CAAC;EACzC,MAAMC,QAAQ,GAAGnC,aAAa,CAACkC,OAAO,CAAC;EACvC,MAAME,QAAQ,GAAGX,cAAc,CAACR,CAAC,CAACmB,QAAQ,CAAC;EAC3C,MAAMC,SAAS,GAAGrC,aAAa,CAACoC,QAAQ,CAAC;EACzC;IACED,QAAQ,KAAKpC,IAAI,CAACuC,WAAW;IAC7BH,QAAQ,KAAKpC,IAAI,CAACwC,aAAa;IAC/BF,SAAS,KAAKtC,IAAI,CAACuC,WAAW;IAC9BD,SAAS,KAAKtC,IAAI,CAACwC,aAAa;;AAEpC,CAAC,CAAC;AACFxB,aAAa,CAAC,CAAC;AACfD,OAAO,CAAC,SAAS,EAAEV,SAAS;AAC5B,CAAC;AACDY,iBAAiB,CAAC,CAACC,CAAC,KAAK;EACvB,MAAMS,QAAQ,GAAG,CAAC,WAAW,CAAC;EAC9B,MAAMU,QAAQ,GAAGX,cAAc,CAACR,CAAC,CAACL,MAAM,CAACwB,QAAQ,CAAC;EAClD,MAAMF,OAAO,GAAGT,cAAc,CAACR,CAAC,CAACL,MAAM,CAACsB,OAAO,CAAC;EAChD,IAAIE,QAAQ,CAACR,WAAW,CAAC,CAAC,IAAIM,OAAO,CAACN,WAAW,CAAC,CAAC,EAAE;IACnDF,QAAQ,CAACG,IAAI,CAAC,eAAe,CAAC;IAC9BH,QAAQ,CAACG,IAAI,CAAC,YAAY,CAAC;EAC7B;EACAZ,CAAC,CAACC,0BAA0B,CAACQ,QAAQ,CAAC;AACxC,CAAC,CAAC;AACFP,EAAE,CAAC,CAACF,CAAC,KAAK;EACR,MAAMmB,QAAQ,GAAGX,cAAc,CAACR,CAAC,CAACL,MAAM,CAACwB,QAAQ,CAAC;EAClD,MAAMF,OAAO,GAAGT,cAAc,CAACR,CAAC,CAACL,MAAM,CAACsB,OAAO,CAAC;EAChD,IAAIJ,OAAO,GAAG,qBAAqB;EACnC,IAAIM,QAAQ,CAACR,WAAW,CAAC,CAAC,IAAIM,OAAO,CAACN,WAAW,CAAC,CAAC,EAAE;IACnDE,OAAO,IAAI,oCAAoC;EACjD;EACA,MAAMP,IAAI,GAAG;AACf,EAAEO,OAAO;AACT;AACA;AACA,cAAcI,OAAO,CAACM,QAAQ,CAAC,CAAC,MAAMvB,CAAC,CAACL,MAAM,CAACL,OAAO,IAAI6B,QAAQ,CAACL,MAAM,CAAC,CAAC,CAAC,CAACR,IAAI,CAAC,CAAC;AACnF,EAAE;;EAEA,MAAMkB,MAAM,GAAGzC,aAAa,CAACoC,QAAQ,CAAC,KAAKrC,IAAI,CAACiC,IAAI,IAAII,QAAQ,KAAKF,OAAO;EAC5EjB,CAAC,CAACK,mBAAmB,CAACmB,MAAM,EAAElB,IAAI,CAAC;AACrC,CAAC,CAAC;;AAEFpB,CAAC,CAACO,IAAI,CAAC,OAAO,CAAC;AACfC,IAAI,CAAC,8CAA8C,CAAC;AACpDC,MAAM,CAAC,CAACC,CAAC;AACTA,CAAC;AACDC,OAAO,CAAC,OAAO,EAAE,CAAC,SAAS,EAAE,UAAU,EAAE,QAAQ,CAAC,CAAC;AACnDC,aAAa,CAAC,CAAC;AACfD,OAAO,CAAC,SAAS,EAAEV,SAAS;AAC5B,CAAC;AACDY,iBAAiB,CAAC,CAACC,CAAC,KAAK;EACvBA,CAAC,CAACC,0BAA0B,CAAC,WAAW,CAAC;AAC3C,CAAC,CAAC;AACFC,EAAE,CAAC,CAACF,CAAC,KAAK;EACR,MAAMyB,OAAO,GAAG;AAClB;AACA;AACA;AACA,EAAE;;EAEA,MAAMC,QAAQ,GAAG;AACnB;AACA;AACA;AACA,EAAE;;EAEA,MAAMC,MAAM,GAAG;AACjB;AACA;AACA;AACA;AACA,EAAE;;EAEA,MAAMC,KAAK,GAAG,EAAEH,OAAO,EAAEC,QAAQ,EAAEC,MAAM,CAAC,CAAC,CAAC3B,CAAC,CAACL,MAAM,CAACS,KAAK,CAAC;EAC3D,MAAME,IAAI,GAAG;AACf;AACA;AACA,QAAQN,CAAC,CAACL,MAAM,CAACL,OAAO;AACxB;AACA;AACA,EAAEsC,KAAK;AACP,CAAC;;EAEC5B,CAAC,CAACK,mBAAmB,CAACL,CAAC,CAACL,MAAM,CAACS,KAAK,KAAK,QAAQ,EAAEE,IAAI,CAAC;AAC1D,CAAC,CAAC;;AAEF,MAAMuB,iBAAiB,GAAG;EACxBC,SAAS,EAAE,iBAAiB;EAC5BC,SAAS,EAAE,iBAAiB;EAC5BC,QAAQ,EAAE,KAAK;EACfC,QAAQ,EAAE,SAAS;EACnBC,QAAQ,EAAE,WAAW;EACrBC,QAAQ,EAAE,WAAW;EACrBC,SAAS,EAAE;AACb,CAAC;;AAEDlD,CAAC,CAACO,IAAI,CAAC,eAAe,CAAC;AACvBC,IAAI,CAAC,iDAAiD,CAAC;AACvDC,MAAM,CAAC,CAACC,CAAC;AACTA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAEjB,MAAM,CAACiD,iBAAiB,CAAC,CAAC,CAAC/B,aAAa,CAAC,CAAC,CAACD,OAAO,CAAC,SAAS,EAAEV,SAAS;AACzF,CAAC;AACDY,iBAAiB,CAAC,CAACC,CAAC,KAAK;EACvBA,CAAC,CAACC,0BAA0B,CAAC,WAAW,CAAC;AAC3C,CAAC,CAAC;AACFC,EAAE,CAAC,CAACF,CAAC,KAAK;EACR,MAAMqC,GAAG,GAAGR,iBAAiB,CAAC7B,CAAC,CAACL,MAAM,CAAC2C,IAAI,CAAC;EAC5C,MAAMhC,IAAI,GAAG;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQN,CAAC,CAACL,MAAM,CAACL,OAAO,IAAI+C,GAAG;AAC/B,EAAE;;EAEArC,CAAC,CAACK,mBAAmB,CAAC,KAAK,EAAEC,IAAI,CAAC;AACpC,CAAC,CAAC","ignoreList":[]}