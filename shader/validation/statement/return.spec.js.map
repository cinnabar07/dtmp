{"version":3,"file":"return.spec.js","names":["description","makeTestGroup","keysOf","isConvertible","scalarTypeOf","Type","ShaderValidationTest","g","kTestTypesNoAbstract","kTestTypes","test","desc","params","u","combine","undefined","beforeAllSubcases","t","type","kind","selectDeviceOrSkipTestCase","fn","enable","code","pass","expectCompileResult","create","wgsl","return_value_type","fn_return_type","returnValueType","fnReturnType","kTests","no_expr","pass_value","pass_no_value","v","literal","expr","paren_expr","call","v_no_semicolon","expr_no_semicolon","phony_assign","increment","compound_assign","lparen_literal","literal_lparen","rparen_literal","literal_rparen","lparen_literal_lparen","rparen_literal_rparen","fn_returns_value"],"sources":["../../../../../src/webgpu/shader/validation/statement/return.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `Validation tests for 'return' statements'`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { isConvertible, scalarTypeOf, Type } from '../../../util/conversion.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kTestTypesNoAbstract = [\n'bool',\n'i32',\n'u32',\n'f32',\n'f16',\n'vec2f',\n'vec3h',\n'vec4u',\n'vec3b',\n'mat2x3f',\n'mat4x2h'];\n\n\nconst kTestTypes = [\n...kTestTypesNoAbstract,\n'abstract-int',\n'abstract-float',\n'vec2af',\n'vec3af',\n'vec4af',\n'vec2ai',\n'vec3ai',\n'vec4ai'];\n\n\ng.test('return_missing_value').\ndesc(`Tests that a 'return' must have a value if the function has a return type`).\nparams((u) => u.combine('type', [...kTestTypesNoAbstract, undefined])).\nbeforeAllSubcases((t) => {\n  if (t.params.type !== undefined && scalarTypeOf(Type[t.params.type]).kind) {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  }\n}).\nfn((t) => {\n  const type = t.params.type ? Type[t.params.type] : undefined;\n  const enable = type && scalarTypeOf(type).kind === 'f16' ? 'enable f16;' : '';\n  const code = `\n${enable}\n\nfn f()${type ? `-> ${type}` : ''} {\n  return;\n}\n`;\n\n  const pass = type === undefined;\n  t.expectCompileResult(pass, code);\n});\n\ng.test('return_unexpected_value').\ndesc(`Tests that a 'return' must not have a value if the function has no return type`).\nparams((u) => u.combine('type', [...kTestTypes, undefined])).\nbeforeAllSubcases((t) => {\n  if (t.params.type !== undefined && scalarTypeOf(Type[t.params.type]).kind) {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  }\n}).\nfn((t) => {\n  const type = t.params.type ? Type[t.params.type] : undefined;\n  const enable = type && scalarTypeOf(type).kind === 'f16' ? 'enable f16;' : '';\n  const code = `\n${enable}\n\nfn f() {\n  return ${type ? `${type.create(1).wgsl()}` : ''};\n}\n`;\n\n  const pass = type === undefined;\n  t.expectCompileResult(pass, code);\n});\n\ng.test('return_type_match').\ndesc(`Tests that a 'return' value type must match the function return type`).\nparams((u) =>\nu.combine('return_value_type', kTestTypes).combine('fn_return_type', kTestTypesNoAbstract)\n).\nbeforeAllSubcases((t) => {\n  if (\n  scalarTypeOf(Type[t.params.return_value_type]).kind === 'f16' ||\n  scalarTypeOf(Type[t.params.fn_return_type]).kind === 'f16')\n  {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  }\n}).\nfn((t) => {\n  const returnValueType = Type[t.params.return_value_type];\n  const fnReturnType = Type[t.params.fn_return_type];\n  const enable =\n  scalarTypeOf(returnValueType).kind === 'f16' || scalarTypeOf(fnReturnType).kind === 'f16' ?\n  'enable f16;' :\n  '';\n  const code = `\n${enable}\n\nfn f() -> ${fnReturnType} {\n  return ${returnValueType.create(1).wgsl()};\n}\n`;\n\n  const pass = isConvertible(returnValueType, fnReturnType);\n  t.expectCompileResult(pass, code);\n});\n\nconst kTests = {\n  no_expr: { wgsl: `return;`, pass_value: false, pass_no_value: true },\n  v: { wgsl: `return v;`, pass_value: true, pass_no_value: false },\n  literal: { wgsl: `return 10;`, pass_value: true, pass_no_value: false },\n  expr: { wgsl: `return 1 + 2;`, pass_value: true, pass_no_value: false },\n  paren_expr: { wgsl: `return (1 + 2);`, pass_value: true, pass_no_value: false },\n  call: { wgsl: `return x();`, pass_value: true, pass_no_value: false },\n\n  v_no_semicolon: { wgsl: `return v`, pass_value: false, pass_no_value: false },\n  expr_no_semicolon: { wgsl: `return 1 + 2`, pass_value: false, pass_no_value: false },\n  phony_assign: { wgsl: `return _ = 1;`, pass_value: false, pass_no_value: false },\n  increment: { wgsl: `return v++;`, pass_value: false, pass_no_value: false },\n  compound_assign: { wgsl: `return v += 4;`, pass_value: false, pass_no_value: false },\n  lparen_literal: { wgsl: `return (4;`, pass_value: false, pass_no_value: false },\n  literal_lparen: { wgsl: `return 4(;`, pass_value: false, pass_no_value: false },\n  rparen_literal: { wgsl: `return )4;`, pass_value: false, pass_no_value: false },\n  literal_rparen: { wgsl: `return 4);`, pass_value: false, pass_no_value: false },\n  lparen_literal_lparen: { wgsl: `return (4(;`, pass_value: false, pass_no_value: false },\n  rparen_literal_rparen: { wgsl: `return )4);`, pass_value: false, pass_no_value: false }\n};\n\ng.test('parse').\ndesc(`Test that 'return' statements are parsed correctly.`).\nparams((u) =>\nu.combine('test', keysOf(kTests)).combine('fn_returns_value', [false, true])\n).\nfn((t) => {\n  const code = `\nfn f() ${t.params.fn_returns_value ? '-> i32' : ''} {\n  let v = 42;\n  ${kTests[t.params.test].wgsl}\n}\nfn x() -> i32 {\n  return 1;\n}\n`;\n  t.expectCompileResult(\n    t.params.fn_returns_value ?\n    kTests[t.params.test].pass_value :\n    kTests[t.params.test].pass_no_value,\n    code\n  );\n});"],"mappings":";;IAAA;AACA;AACA,GAAG,OAAO,MAAMA,WAAW,GAAG,2CAA2C,CAAC,SAASC,aAAa,QAAQ,4CAA4C,CACpJ,SAASC,MAAM,QAAQ,wCAAwC,CAC/D,SAASC,aAAa,EAAEC,YAAY,EAAEC,IAAI,QAAQ,6BAA6B;AAC/E,SAASC,oBAAoB,QAAQ,8BAA8B;;AAEnE,OAAO,MAAMC,CAAC,GAAGN,aAAa,CAACK,oBAAoB,CAAC;;AAEpD,MAAME,oBAAoB,GAAG;AAC7B,MAAM;AACN,KAAK;AACL,KAAK;AACL,KAAK;AACL,KAAK;AACL,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,SAAS;AACT,SAAS,CAAC;;;AAGV,MAAMC,UAAU,GAAG;AACnB,GAAGD,oBAAoB;AACvB,cAAc;AACd,gBAAgB;AAChB,QAAQ;AACR,QAAQ;AACR,QAAQ;AACR,QAAQ;AACR,QAAQ;AACR,QAAQ,CAAC;;;AAGTD,CAAC,CAACG,IAAI,CAAC,sBAAsB,CAAC;AAC9BC,IAAI,CAAC,2EAA2E,CAAC;AACjFC,MAAM,CAAC,CAACC,CAAC,KAAKA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAE,CAAC,GAAGN,oBAAoB,EAAEO,SAAS,CAAC,CAAC,CAAC;AACtEC,iBAAiB,CAAC,CAACC,CAAC,KAAK;EACvB,IAAIA,CAAC,CAACL,MAAM,CAACM,IAAI,KAAKH,SAAS,IAAIX,YAAY,CAACC,IAAI,CAACY,CAAC,CAACL,MAAM,CAACM,IAAI,CAAC,CAAC,CAACC,IAAI,EAAE;IACzEF,CAAC,CAACG,0BAA0B,CAAC,YAAY,CAAC;EAC5C;AACF,CAAC,CAAC;AACFC,EAAE,CAAC,CAACJ,CAAC,KAAK;EACR,MAAMC,IAAI,GAAGD,CAAC,CAACL,MAAM,CAACM,IAAI,GAAGb,IAAI,CAACY,CAAC,CAACL,MAAM,CAACM,IAAI,CAAC,GAAGH,SAAS;EAC5D,MAAMO,MAAM,GAAGJ,IAAI,IAAId,YAAY,CAACc,IAAI,CAAC,CAACC,IAAI,KAAK,KAAK,GAAG,aAAa,GAAG,EAAE;EAC7E,MAAMI,IAAI,GAAG;AACf,EAAED,MAAM;AACR;AACA,QAAQJ,IAAI,GAAG,MAAMA,IAAI,EAAE,GAAG,EAAE;AAChC;AACA;AACA,CAAC;;EAEC,MAAMM,IAAI,GAAGN,IAAI,KAAKH,SAAS;EAC/BE,CAAC,CAACQ,mBAAmB,CAACD,IAAI,EAAED,IAAI,CAAC;AACnC,CAAC,CAAC;;AAEFhB,CAAC,CAACG,IAAI,CAAC,yBAAyB,CAAC;AACjCC,IAAI,CAAC,gFAAgF,CAAC;AACtFC,MAAM,CAAC,CAACC,CAAC,KAAKA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAE,CAAC,GAAGL,UAAU,EAAEM,SAAS,CAAC,CAAC,CAAC;AAC5DC,iBAAiB,CAAC,CAACC,CAAC,KAAK;EACvB,IAAIA,CAAC,CAACL,MAAM,CAACM,IAAI,KAAKH,SAAS,IAAIX,YAAY,CAACC,IAAI,CAACY,CAAC,CAACL,MAAM,CAACM,IAAI,CAAC,CAAC,CAACC,IAAI,EAAE;IACzEF,CAAC,CAACG,0BAA0B,CAAC,YAAY,CAAC;EAC5C;AACF,CAAC,CAAC;AACFC,EAAE,CAAC,CAACJ,CAAC,KAAK;EACR,MAAMC,IAAI,GAAGD,CAAC,CAACL,MAAM,CAACM,IAAI,GAAGb,IAAI,CAACY,CAAC,CAACL,MAAM,CAACM,IAAI,CAAC,GAAGH,SAAS;EAC5D,MAAMO,MAAM,GAAGJ,IAAI,IAAId,YAAY,CAACc,IAAI,CAAC,CAACC,IAAI,KAAK,KAAK,GAAG,aAAa,GAAG,EAAE;EAC7E,MAAMI,IAAI,GAAG;AACf,EAAED,MAAM;AACR;AACA;AACA,WAAWJ,IAAI,GAAG,GAAGA,IAAI,CAACQ,MAAM,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC,EAAE,GAAG,EAAE;AACjD;AACA,CAAC;;EAEC,MAAMH,IAAI,GAAGN,IAAI,KAAKH,SAAS;EAC/BE,CAAC,CAACQ,mBAAmB,CAACD,IAAI,EAAED,IAAI,CAAC;AACnC,CAAC,CAAC;;AAEFhB,CAAC,CAACG,IAAI,CAAC,mBAAmB,CAAC;AAC3BC,IAAI,CAAC,sEAAsE,CAAC;AAC5EC,MAAM,CAAC,CAACC,CAAC;AACTA,CAAC,CAACC,OAAO,CAAC,mBAAmB,EAAEL,UAAU,CAAC,CAACK,OAAO,CAAC,gBAAgB,EAAEN,oBAAoB;AACzF,CAAC;AACDQ,iBAAiB,CAAC,CAACC,CAAC,KAAK;EACvB;EACAb,YAAY,CAACC,IAAI,CAACY,CAAC,CAACL,MAAM,CAACgB,iBAAiB,CAAC,CAAC,CAACT,IAAI,KAAK,KAAK;EAC7Df,YAAY,CAACC,IAAI,CAACY,CAAC,CAACL,MAAM,CAACiB,cAAc,CAAC,CAAC,CAACV,IAAI,KAAK,KAAK;EAC1D;IACEF,CAAC,CAACG,0BAA0B,CAAC,YAAY,CAAC;EAC5C;AACF,CAAC,CAAC;AACFC,EAAE,CAAC,CAACJ,CAAC,KAAK;EACR,MAAMa,eAAe,GAAGzB,IAAI,CAACY,CAAC,CAACL,MAAM,CAACgB,iBAAiB,CAAC;EACxD,MAAMG,YAAY,GAAG1B,IAAI,CAACY,CAAC,CAACL,MAAM,CAACiB,cAAc,CAAC;EAClD,MAAMP,MAAM;EACZlB,YAAY,CAAC0B,eAAe,CAAC,CAACX,IAAI,KAAK,KAAK,IAAIf,YAAY,CAAC2B,YAAY,CAAC,CAACZ,IAAI,KAAK,KAAK;EACzF,aAAa;EACb,EAAE;EACF,MAAMI,IAAI,GAAG;AACf,EAAED,MAAM;AACR;AACA,YAAYS,YAAY;AACxB,WAAWD,eAAe,CAACJ,MAAM,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC;AAC3C;AACA,CAAC;;EAEC,MAAMH,IAAI,GAAGrB,aAAa,CAAC2B,eAAe,EAAEC,YAAY,CAAC;EACzDd,CAAC,CAACQ,mBAAmB,CAACD,IAAI,EAAED,IAAI,CAAC;AACnC,CAAC,CAAC;;AAEF,MAAMS,MAAM,GAAG;EACbC,OAAO,EAAE,EAAEN,IAAI,EAAE,SAAS,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,IAAI,CAAC,CAAC;EACpEC,CAAC,EAAE,EAAET,IAAI,EAAE,WAAW,EAAEO,UAAU,EAAE,IAAI,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EAChEE,OAAO,EAAE,EAAEV,IAAI,EAAE,YAAY,EAAEO,UAAU,EAAE,IAAI,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EACvEG,IAAI,EAAE,EAAEX,IAAI,EAAE,eAAe,EAAEO,UAAU,EAAE,IAAI,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EACvEI,UAAU,EAAE,EAAEZ,IAAI,EAAE,iBAAiB,EAAEO,UAAU,EAAE,IAAI,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EAC/EK,IAAI,EAAE,EAAEb,IAAI,EAAE,aAAa,EAAEO,UAAU,EAAE,IAAI,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;;EAErEM,cAAc,EAAE,EAAEd,IAAI,EAAE,UAAU,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EAC7EO,iBAAiB,EAAE,EAAEf,IAAI,EAAE,cAAc,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EACpFQ,YAAY,EAAE,EAAEhB,IAAI,EAAE,eAAe,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EAChFS,SAAS,EAAE,EAAEjB,IAAI,EAAE,aAAa,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EAC3EU,eAAe,EAAE,EAAElB,IAAI,EAAE,gBAAgB,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EACpFW,cAAc,EAAE,EAAEnB,IAAI,EAAE,YAAY,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EAC/EY,cAAc,EAAE,EAAEpB,IAAI,EAAE,YAAY,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EAC/Ea,cAAc,EAAE,EAAErB,IAAI,EAAE,YAAY,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EAC/Ec,cAAc,EAAE,EAAEtB,IAAI,EAAE,YAAY,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EAC/Ee,qBAAqB,EAAE,EAAEvB,IAAI,EAAE,aAAa,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC,CAAC;EACvFgB,qBAAqB,EAAE,EAAExB,IAAI,EAAE,aAAa,EAAEO,UAAU,EAAE,KAAK,EAAEC,aAAa,EAAE,KAAK,CAAC;AACxF,CAAC;;AAED5B,CAAC,CAACG,IAAI,CAAC,OAAO,CAAC;AACfC,IAAI,CAAC,qDAAqD,CAAC;AAC3DC,MAAM,CAAC,CAACC,CAAC;AACTA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAEZ,MAAM,CAAC8B,MAAM,CAAC,CAAC,CAAClB,OAAO,CAAC,kBAAkB,EAAE,CAAC,KAAK,EAAE,IAAI,CAAC;AAC3E,CAAC;AACDO,EAAE,CAAC,CAACJ,CAAC,KAAK;EACR,MAAMM,IAAI,GAAG;AACf,SAASN,CAAC,CAACL,MAAM,CAACwC,gBAAgB,GAAG,QAAQ,GAAG,EAAE;AAClD;AACA,IAAIpB,MAAM,CAACf,CAAC,CAACL,MAAM,CAACF,IAAI,CAAC,CAACiB,IAAI;AAC9B;AACA;AACA;AACA;AACA,CAAC;EACCV,CAAC,CAACQ,mBAAmB;IACnBR,CAAC,CAACL,MAAM,CAACwC,gBAAgB;IACzBpB,MAAM,CAACf,CAAC,CAACL,MAAM,CAACF,IAAI,CAAC,CAACwB,UAAU;IAChCF,MAAM,CAACf,CAAC,CAACL,MAAM,CAACF,IAAI,CAAC,CAACyB,aAAa;IACnCZ;EACF,CAAC;AACH,CAAC,CAAC","ignoreList":[]}