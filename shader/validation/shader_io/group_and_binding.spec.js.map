{"version":3,"file":"group_and_binding.spec.js","names":["description","makeTestGroup","ShaderValidationTest","declareEntrypoint","kResourceEmitters","kResourceKindsA","kResourceKindsAll","kResourceKindsB","g","test","desc","params","u","combine","beginSubcases","fn","t","emitter","get","resource","code","has_group","undefined","has_binding","expect","expectCompileResult","filter","stage","b_kind","resourceA","a_kind","resourceB","resources","a_group","a_binding","b_group","b_binding","usage","b_stage","a_stage"],"sources":["../../../../../src/webgpu/shader/validation/shader_io/group_and_binding.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `Validation tests for group and binding`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nimport {\n  declareEntrypoint,\n  kResourceEmitters,\n  kResourceKindsA,\n  kResourceKindsAll,\n  kResourceKindsB } from\n\n'./util.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('binding_attributes').\ndesc(`Test that both @group and @binding attributes must both be declared.`).\nparams((u) =>\nu.\ncombine('stage', ['vertex', 'fragment', 'compute']).\ncombine('has_group', [true, false]).\ncombine('has_binding', [true, false]).\ncombine('resource', kResourceKindsAll).\nbeginSubcases()\n).\nfn((t) => {\n  const emitter = kResourceEmitters.get(t.params.resource);\n  //const emitter = kResourceEmitters.get('uniform') as ResourceDeclarationEmitter;\n  const code = emitter(\n    'R',\n    t.params.has_group ? 0 : undefined,\n    t.params.has_binding ? 0 : undefined\n  );\n  const expect = t.params.has_group && t.params.has_binding;\n  t.expectCompileResult(expect, code);\n});\n\ng.test('private_module_scope').\ndesc(`Test validation of group and binding on private resources`).\nfn((t) => {\n  const code = `\n@group(1) @binding(1)\nvar<private> a: i32;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  _ = a;\n}`;\n  t.expectCompileResult(false, code);\n});\n\ng.test('private_function_scope').\ndesc(`Test validation of group and binding on function-scope private resources`).\nfn((t) => {\n  const code = `\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  @group(1) @binding(1)\n  var<private> a: i32;\n}`;\n  t.expectCompileResult(false, code);\n});\n\ng.test('function_scope').\ndesc(`Test validation of group and binding on function-scope private resources`).\nfn((t) => {\n  const code = `\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  @group(1) @binding(1)\n  var a: i32;\n}`;\n  t.expectCompileResult(false, code);\n});\n\ng.test('function_scope_texture').\ndesc(`Test validation of group and binding on function-scope private resources`).\nfn((t) => {\n  const code = `\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  @group(1) @binding(1)\n  var a: texture_2d<f32>;\n}`;\n  t.expectCompileResult(false, code);\n});\n\ng.test('single_entry_point').\ndesc(\n  `Test that two different resource variables in a shader must not have the same group and binding values, when considered as a pair.`\n).\nparams((u) =>\nu.\ncombine('stage', ['vertex', 'fragment', 'compute']).\ncombine('a_kind', kResourceKindsA).\ncombine('b_kind', kResourceKindsB).\ncombine('usage', ['direct', 'transitive']).\nfilter((t) => {\n  return !(t.stage === 'vertex' && t.b_kind === 'texture_storage_1d');\n}).\nbeginSubcases().\ncombine('a_group', [0, 3]).\ncombine('b_group', [0, 3]).\ncombine('a_binding', [0, 3]).\ncombine('b_binding', [0, 3])\n).\nfn((t) => {\n  const resourceA = kResourceEmitters.get(t.params.a_kind);\n  const resourceB = kResourceEmitters.get(t.params.b_kind);\n  const resources = `\n${resourceA('resource_a', t.params.a_group, t.params.a_binding)}\n${resourceB('resource_b', t.params.b_group, t.params.b_binding)}\n`;\n  const expect =\n  t.params.a_group !== t.params.b_group || t.params.a_binding !== t.params.b_binding;\n\n  if (t.params.usage === 'direct') {\n    const code = `\n${resources}\n${declareEntrypoint('main', t.params.stage, '_ = resource_a; _ = resource_b;')}\n`;\n    t.expectCompileResult(expect, code);\n  } else {\n    const code = `\n${resources}\nfn use_a() { _ = resource_a; }\nfn use_b() { _ = resource_b; }\n${declareEntrypoint('main', t.params.stage, 'use_a(); use_b();')}\n`;\n    t.expectCompileResult(expect, code);\n  }\n});\n\ng.test('different_entry_points').\ndesc(\n  `Test that resources may use the same binding points if exclusively accessed by different entry points.`\n).\nparams((u) =>\nu.\ncombine('a_stage', ['vertex', 'fragment', 'compute']).\ncombine('b_stage', ['vertex', 'fragment', 'compute']).\ncombine('a_kind', kResourceKindsA).\ncombine('b_kind', kResourceKindsB).\ncombine('usage', ['direct', 'transitive']).\nfilter((t) => {\n  return !(t.b_stage === 'vertex' && t.b_kind === 'texture_storage_1d');\n}).\nbeginSubcases()\n).\nfn((t) => {\n  const resourceA = kResourceEmitters.get(t.params.a_kind);\n  const resourceB = kResourceEmitters.get(t.params.b_kind);\n  const resources = `\n${resourceA('resource_a', /* group */0, /* binding */0)}\n${resourceB('resource_b', /* group */0, /* binding */0)}\n`;\n  const expect = true; // Binding reuse between different entry points is fine.\n\n  if (t.params.usage === 'direct') {\n    const code = `\n${resources}\n${declareEntrypoint('main_a', t.params.a_stage, '_ = resource_a;')}\n${declareEntrypoint('main_b', t.params.b_stage, '_ = resource_b;')}\n`;\n    t.expectCompileResult(expect, code);\n  } else {\n    const code = `\n${resources}\nfn use_a() { _ = resource_a; }\nfn use_b() { _ = resource_b; }\n${declareEntrypoint('main_a', t.params.a_stage, 'use_a();')}\n${declareEntrypoint('main_b', t.params.b_stage, 'use_b();')}\n`;\n    t.expectCompileResult(expect, code);\n  }\n});"],"mappings":"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","ignoreList":[]}