{"version":3,"file":"pipeline_stage.spec.js","names":["description","makeTestGroup","ShaderValidationTest","g","kValidVertex","Set","kInvalidVertex","test","desc","params","u","combine","fn","t","v","val","replace","r","code","expectCompileResult","has","kValidFragment","kInvalidFragment","kValidCompute","kInvalidCompute","before","extra","after","undefined","scope","attr"],"sources":["../../../../../src/webgpu/shader/validation/shader_io/pipeline_stage.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `Validation tests for pipeline stage`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kValidVertex = new Set(['', '@vertex', '@\\tvertex', '@/^comment^/vertex']);\nconst kInvalidVertex = new Set(['@mvertex', '@vertex()', '@vertex )', '@vertex(']);\ng.test('vertex_parsing').\ndesc(`Test that @vertex is parsed correctly.`).\nparams((u) => u.combine('val', new Set([...kValidVertex, ...kInvalidVertex]))).\nfn((t) => {\n  const v = t.params.val.replace(/\\^/g, '*');\n  const r = t.params.val !== '' ? '@builtin(position)' : '';\n  const code = `\n${v}\nfn main() -> ${r} vec4<f32> {\n  return vec4<f32>(.4, .2, .3, .1);\n}`;\n  t.expectCompileResult(kValidVertex.has(t.params.val), code);\n});\n\nconst kValidFragment = new Set(['', '@fragment', '@\\tfragment', '@/^comment^/fragment']);\nconst kInvalidFragment = new Set(['@mfragment', '@fragment()', '@fragment )', '@fragment(']);\ng.test('fragment_parsing').\ndesc(`Test that @fragment is parsed correctly.`).\nparams((u) => u.combine('val', new Set([...kValidFragment, ...kInvalidFragment]))).\nfn((t) => {\n  const v = t.params.val.replace(/\\^/g, '*');\n  const r = t.params.val !== '' ? '@location(0)' : '';\n  const code = `\n${v}\nfn main() -> ${r} vec4<f32> {\n  return vec4<f32>(.4, .2, .3, .1);\n}`;\n  t.expectCompileResult(kValidFragment.has(t.params.val), code);\n});\n\nconst kValidCompute = new Set(['', '@compute', '@\\tcompute', '@/^comment^/compute']);\nconst kInvalidCompute = new Set(['@mcompute', '@compute()', '@compute )', '@compute(']);\ng.test('compute_parsing').\ndesc(`Test that @compute is parsed correctly.`).\nparams((u) => u.combine('val', new Set([...kValidCompute, ...kInvalidCompute]))).\nfn((t) => {\n  let v = t.params.val.replace(/\\^/g, '*');\n  // Always add a workgroup size unless there is no parameter\n  if (v !== '') {\n    v += '\\n@workgroup_size(1)';\n  }\n  const code = `\n${v}\nfn main() {}\n`;\n  t.expectCompileResult(kValidCompute.has(t.params.val), code);\n});\n\ng.test('multiple_entry_points').\ndesc(`Test that multiple entry points are allowed.`).\nfn((t) => {\n  const code = `\n@compute @workgroup_size(1) fn compute_1() {}\n@compute @workgroup_size(1) fn compute_2() {}\n\n@fragment fn frag_1() -> @location(2) vec4f { return vec4f(1); }\n@fragment fn frag_2() -> @location(2) vec4f { return vec4f(1); }\n@fragment fn frag_3() -> @location(2) vec4f { return vec4f(1); }\n\n@vertex fn vtx_1() -> @builtin(position) vec4f { return vec4f(1); }\n@vertex fn vtx_2() -> @builtin(position) vec4f { return vec4f(1); }\n@vertex fn vtx_3() -> @builtin(position) vec4f { return vec4f(1); }\n`;\n  t.expectCompileResult(true, code);\n});\n\ng.test('extra_on_compute_function').\ndesc(`Test that an extra stage attribute on @compute functions are not allowed.`).\nparams((u) =>\nu.combine('extra', ['', '@compute', '@fragment', '@vertex']).combine('before', [false, true])\n).\nfn((t) => {\n  const before = t.params.before ? t.params.extra : '';\n  const after = t.params.before ? '' : t.params.extra;\n  const code = `\n${before} @compute ${after} @workgroup_size(1) fn main() {}\n`;\n  t.expectCompileResult(t.params.extra === '', code);\n});\n\ng.test('extra_on_fragment_function').\ndesc(`Test that an extra stage attribute on @fragment functions are not allowed.`).\nparams((u) =>\nu.combine('extra', ['', '@compute', '@fragment', '@vertex']).combine('before', [false, true])\n).\nfn((t) => {\n  const before = t.params.before ? t.params.extra : '';\n  const after = t.params.before ? '' : t.params.extra;\n  const code = `\n${before} @fragment ${after} fn main() -> @location(0) vec4f { return vec4f(1); }\n`;\n  t.expectCompileResult(t.params.extra === '', code);\n});\n\ng.test('extra_on_vertex_function').\ndesc(`Test that an extra stage attribute on @vertex functions are not allowed.`).\nparams((u) =>\nu.combine('extra', ['', '@compute', '@fragment', '@vertex']).combine('before', [false, true])\n).\nfn((t) => {\n  const before = t.params.before ? t.params.extra : '';\n  const after = t.params.before ? '' : t.params.extra;\n  const code = `\n${before} @vertex ${after} fn main() -> @builtin(position) vec4f { return vec4f(1); }\n`;\n  t.expectCompileResult(t.params.extra === '', code);\n});\n\ng.test('placement').\ndesc('Tests the locations @align is allowed to appear').\nparams((u) =>\nu.\ncombine('scope', [\n'private-var',\n'storage-var',\n'struct-member',\n'fn-param',\n'fn-var',\n'fn-return',\n'while-stmt',\nundefined]\n).\ncombine('attr', ['@compute', '@fragment', '@vertex'])\n).\nfn((t) => {\n  const scope = t.params.scope;\n\n  const attr = t.params.attr;\n  const code = `\n      ${scope === 'private-var' ? attr : ''}\n      var<private> priv_var : i32;\n\n      ${scope === 'storage-var' ? attr : ''}\n      @group(0) @binding(0)\n      var<storage> stor_var : i32;\n\n      struct A {\n        ${scope === 'struct-member' ? attr : ''}\n        a : i32,\n      }\n\n      @vertex\n      fn f(\n        ${scope === 'fn-param' ? attr : ''}\n        @location(0) b : i32,\n      ) -> ${scope === 'fn-return' ? attr : ''} @builtin(position) vec4f {\n        ${scope === 'fn-var' ? attr : ''}\n        var<function> func_v : i32;\n\n        ${scope === 'while-stmt' ? attr : ''}\n        while false {}\n\n        return vec4(1, 1, 1, 1);\n      }\n    `;\n\n  t.expectCompileResult(scope === undefined, code);\n});"],"mappings":"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","ignoreList":[]}