{"version":3,"file":"interpolate.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","generateShader","g","kValidInterpolationAttributes","Set","test","desc","params","u","combine","filter","t","stage","use_struct","beginSubcases","fn","interpolate","type","sampling","code","attribute","io","expectCompileResult","has","includes","skip","expectSuccess","startsWith","attr","kValidationTests","valid","src","pass","no_space","trailing_comma_one_arg","trailing_comma_two_arg","newline","comment","no_params","missing_left_paren","missing_value_and_left_paren","missing_right_paren","missing_parens","missing_comma","numeric","numeric_second_param"],"sources":["../../../../../src/webgpu/shader/validation/shader_io/interpolate.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `Validation tests for the interpolate attribute`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nimport { generateShader } from './util.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\n// List of valid interpolation attributes.\nconst kValidInterpolationAttributes = new Set([\n'',\n'@interpolate(perspective)',\n'@interpolate(perspective, center)',\n'@interpolate(perspective, centroid)',\n'@interpolate(flat)',\n'@interpolate(flat, first)',\n'@interpolate(flat, either)',\n'@interpolate(perspective)',\n'@interpolate(perspective, center)',\n'@interpolate(perspective, centroid)',\n'@interpolate(perspective, sample)',\n'@interpolate(linear)',\n'@interpolate(linear, center)',\n'@interpolate(linear, centroid)',\n'@interpolate(linear, sample)']\n);\n\ng.test('type_and_sampling').\ndesc(`Test that all combinations of interpolation type and sampling are validated correctly.`).\nparams((u) =>\nu.\ncombine('stage', ['vertex', 'fragment']).\ncombine('io', ['in', 'out']).\ncombine('use_struct', [true, false]).\ncombine('type', [\n'',\n'flat',\n'perspective',\n'linear',\n'center', // Invalid as first param\n'centroid', // Invalid as first param\n'sample', // Invalid as first param\n'first', // Invalid as first param\n'either' // Invalid as first param\n])\n// vertex output must include a position builtin, so must use a struct\n.filter((t) => !(t.stage === 'vertex' && t.use_struct === false)).\ncombine('sampling', [\n'',\n'center',\n'centroid',\n'sample',\n'first',\n'either',\n'flat', // Invalid as second param\n'perspective', // Invalid as second param\n'linear' // Invalid as second param\n]).\nbeginSubcases()\n).\nfn((t) => {\n  let interpolate = '';\n  if (t.params.type !== '' || t.params.sampling !== '') {\n    interpolate = '@interpolate(';\n    if (t.params.type !== '') {\n      interpolate += `${t.params.type}`;\n    }\n    if (t.params.sampling !== '') {\n      interpolate += `, ${t.params.sampling}`;\n    }\n    interpolate += `)`;\n  }\n  const code = generateShader({\n    attribute: '@location(0)' + interpolate,\n    type: 'f32',\n    stage: t.params.stage,\n    io: t.params.io,\n    use_struct: t.params.use_struct\n  });\n  t.expectCompileResult(kValidInterpolationAttributes.has(interpolate), code);\n});\n\ng.test('require_location').\ndesc(`Test that the interpolate attribute is only accepted with user-defined IO.`).\nparams((u) =>\nu.\ncombine('stage', ['vertex', 'fragment']).\ncombine('attribute', ['@location(0)', '@builtin(position)']).\ncombine('use_struct', [true, false]).\nbeginSubcases()\n).\nfn((t) => {\n  if (\n  t.params.stage === 'vertex' &&\n  t.params.use_struct === false &&\n  !t.params.attribute.includes('position'))\n  {\n    t.skip('vertex output must include a position builtin, so must use a struct');\n  }\n\n  const code = generateShader({\n    attribute: t.params.attribute + `@interpolate(flat, either)`,\n    type: 'vec4<f32>',\n    stage: t.params.stage,\n    io: t.params.stage === 'fragment' ? 'in' : 'out',\n    use_struct: t.params.use_struct\n  });\n  t.expectCompileResult(t.params.attribute === '@location(0)', code);\n});\n\ng.test('integral_types').\ndesc(`Test that the implementation requires @interpolate(flat) for integral user-defined IO.`).\nparams((u) =>\nu.\ncombine('stage', ['vertex', 'fragment']).\ncombine('type', ['i32', 'u32', 'vec2<i32>', 'vec4<u32>']).\ncombine('use_struct', [true, false]).\ncombine('attribute', kValidInterpolationAttributes).\nbeginSubcases()\n).\nfn((t) => {\n  if (t.params.stage === 'vertex' && t.params.use_struct === false) {\n    t.skip('vertex output must include a position builtin, so must use a struct');\n  }\n\n  const code = generateShader({\n    attribute: '@location(0)' + t.params.attribute,\n    type: t.params.type,\n    stage: t.params.stage,\n    io: t.params.stage === 'vertex' ? 'out' : 'in',\n    use_struct: t.params.use_struct\n  });\n\n  const expectSuccess = t.params.attribute.startsWith('@interpolate(flat');\n  t.expectCompileResult(expectSuccess, code);\n});\n\ng.test('duplicate').\ndesc(`Test that the interpolate attribute can only be applied once.`).\nparams((u) => u.combine('attr', ['', '@interpolate(flat)'])).\nfn((t) => {\n  const code = generateShader({\n    attribute: `@location(0) @interpolate(flat, either) ${t.params.attr}`,\n    type: 'vec4<f32>',\n    stage: 'fragment',\n    io: 'in',\n    use_struct: false\n  });\n  t.expectCompileResult(t.params.attr === '', code);\n});\n\nconst kValidationTests = {\n  valid: {\n    src: `@interpolate(perspective)`,\n    pass: true\n  },\n  no_space: {\n    src: `@interpolate(perspective,center)`,\n    pass: true\n  },\n  trailing_comma_one_arg: {\n    src: `@interpolate(flat,)`,\n    pass: true\n  },\n  trailing_comma_two_arg: {\n    src: `@interpolate(perspective, center,)`,\n    pass: true\n  },\n  newline: {\n    src: '@\\ninterpolate(perspective)',\n    pass: true\n  },\n  comment: {\n    src: `@/* comment */interpolate(perspective)`,\n    pass: true\n  },\n\n  no_params: {\n    src: `@interpolate()`,\n    pass: false\n  },\n  missing_left_paren: {\n    src: `@interpolate perspective)`,\n    pass: false\n  },\n  missing_value_and_left_paren: {\n    src: `@interpolate)`,\n    pass: false\n  },\n  missing_right_paren: {\n    src: `@interpolate(perspective`,\n    pass: false\n  },\n  missing_parens: {\n    src: `@interpolate`,\n    pass: false\n  },\n  missing_comma: {\n    src: `@interpolate(perspective center)`,\n    pass: false\n  },\n  numeric: {\n    src: `@interpolate(1)`,\n    pass: false\n  },\n  numeric_second_param: {\n    src: `@interpolate(perspective, 1)`,\n    pass: false\n  }\n};\n\ng.test('interpolation_validation').\ndesc(`Test validation of interpolation`).\nparams((u) => u.combine('attr', keysOf(kValidationTests))).\nfn((t) => {\n  const code = `\n@vertex fn main(${kValidationTests[t.params.attr].src} @location(0) b: f32) ->\n    @builtin(position) vec4<f32> {\n  return vec4f(0);\n}`;\n  const expectSuccess = kValidationTests[t.params.attr].pass;\n  t.expectCompileResult(expectSuccess, code);\n});"],"mappings":"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","ignoreList":[]}