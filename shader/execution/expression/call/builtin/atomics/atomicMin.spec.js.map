{"version":3,"file":"atomicMin.spec.js","names":["description","makeTestGroup","GPUTest","dispatchSizes","workgroupSizes","runStorageVariableTest","runWorkgroupVariableTest","typedArrayCtor","g","test","specURL","desc","params","u","combine","fn","t","bufferNumElements","initValue","scalarType","op","expected","fill","workgroupSize","dispatchSize","wgNumElements","d","wg","subarray"],"sources":["../../../../../../../../src/webgpu/shader/execution/expression/call/builtin/atomics/atomicMin.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nAtomically read, min and store value.\n\n* Load the original value pointed to by atomic_ptr.\n * Obtains a new value by take the min with the value v.\n * Store the new value using atomic_ptr.\n\nReturns the original value stored in the atomic object.\n`;import { makeTestGroup } from '../../../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../../../gpu_test.js';\n\nimport {\n  dispatchSizes,\n  workgroupSizes,\n  runStorageVariableTest,\n  runWorkgroupVariableTest,\n  typedArrayCtor } from\n'./harness.js';\n\nexport const g = makeTestGroup(GPUTest);\n\ng.test('min_storage').\nspecURL('https://www.w3.org/TR/WGSL/#atomic-rmw').\ndesc(\n  `\nAS is storage or workgroup\nT is i32 or u32\n\nfn atomicMin(atomic_ptr: ptr<AS, atomic<T>, read_write>, v: T) -> T\n`\n).\nparams((u) =>\nu.\ncombine('workgroupSize', workgroupSizes).\ncombine('dispatchSize', dispatchSizes).\ncombine('scalarType', ['u32', 'i32'])\n).\nfn((t) => {\n  // Allocate one extra element to ensure it doesn't get modified\n  const bufferNumElements = 2;\n\n  const initValue = t.params.scalarType === 'u32' ? 0xffffffff : 0x7fffffff;\n  const op = `atomicMin(&output[0], id)`;\n  const expected = new (typedArrayCtor(t.params.scalarType))(bufferNumElements).fill(initValue);\n  expected[0] = 0;\n\n  runStorageVariableTest({\n    t,\n    workgroupSize: t.params.workgroupSize,\n    dispatchSize: t.params.dispatchSize,\n    bufferNumElements,\n    initValue,\n    op,\n    expected\n  });\n});\n\ng.test('min_workgroup').\nspecURL('https://www.w3.org/TR/WGSL/#atomic-rmw').\ndesc(\n  `\nAS is storage or workgroup\nT is i32 or u32\n\nfn atomicMin(atomic_ptr: ptr<AS, atomic<T>, read_write>, v: T) -> T\n`\n).\nparams((u) =>\nu.\ncombine('workgroupSize', workgroupSizes).\ncombine('dispatchSize', dispatchSizes).\ncombine('scalarType', ['u32', 'i32'])\n).\nfn((t) => {\n  // Allocate one extra element to ensure it doesn't get modified\n  const wgNumElements = 2;\n\n  const initValue = t.params.scalarType === 'u32' ? 0xffffffff : 0x7fffffff;\n  const op = `atomicMin(&wg[0], id)`;\n\n  const expected = new (typedArrayCtor(t.params.scalarType))(\n    wgNumElements * t.params.dispatchSize\n  ).fill(initValue);\n  for (let d = 0; d < t.params.dispatchSize; ++d) {\n    const wg = expected.subarray(d * wgNumElements);\n    wg[0] = 0;\n  }\n\n  runWorkgroupVariableTest({\n    t,\n    workgroupSize: t.params.workgroupSize,\n    dispatchSize: t.params.dispatchSize,\n    wgNumElements,\n    initValue,\n    op,\n    expected\n  });\n});"],"mappings":"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","ignoreList":[]}