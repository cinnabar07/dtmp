{"version":3,"file":"command_buffer_maker.js","names":["kRenderEncodeTypes","kProgrammableEncoderTypes","kEncoderTypes","CommandBufferMaker","constructor","t","encoder","finish","validateFinish","shouldSucceed","expectGPUError","validateFinishAndSubmit","shouldBeValid","submitShouldSucceedIfValid","commandBuffer","expectValidationError","globalThis","_TRAMPOLINE_","queue","submit","validateFinishAndSubmitGivenState","resourceState"],"sources":["../../../src/webgpu/util/command_buffer_maker.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const kRenderEncodeTypes = ['render pass', 'render bundle'];\n\nexport const kProgrammableEncoderTypes = ['compute pass', ...kRenderEncodeTypes];\n\nexport const kEncoderTypes = ['non-pass', ...kProgrammableEncoderTypes];\n\n\n// Look up the type of the encoder based on `T`. If `T` is a union, this will be too!\n\n\n\n\n\n\n\n/** See {@link webgpu/api/validation/validation_test.ValidationTest.createEncoder |\n * GPUTest.createEncoder()}. */\nexport class CommandBufferMaker {\n  /** `GPU___Encoder` for recording commands into. */\n  // Look up the type of the encoder based on `T`. If `T` is a union, this will be too!\n\n\n  /**\n   * Finish any passes, finish and record any bundles, and finish/return the command buffer. Any\n   * errors are ignored and the GPUCommandBuffer (which may be an error buffer) is returned.\n   */\n\n\n  /**\n   * Finish any passes, finish and record any bundles, and finish/return the command buffer.\n   * Checks for validation errors in (only) the appropriate finish call.\n   */\n\n\n  /**\n   * Finish the command buffer and submit it. Checks for validation errors in either the submit or\n   * the appropriate finish call, depending on the state of a resource used in the encoding.\n   */\n\n\n\n\n\n  /**\n   * `validateFinishAndSubmit()` based on the state of a resource in the command encoder.\n   * - `finish()` should fail if the resource is 'invalid'.\n   * - Only `submit()` should fail if the resource is 'destroyed'.\n   */\n\n\n  constructor(\n  t,\n  encoder,\n  finish)\n  {\n    // TypeScript introduces an intersection type here where we don't want one.\n    this.encoder = encoder;\n    this.finish = finish;\n\n    // Define extra methods like this, otherwise they get unbound when destructured, e.g.:\n    //   const { encoder, validateFinishAndSubmit } = t.createEncoder(type);\n    // Alternatively, do not destructure, and call member functions, e.g.:\n    //   const encoder = t.createEncoder(type);\n    //   encoder.validateFinish(true);\n    this.validateFinish = (shouldSucceed) => {\n      return t.expectGPUError('validation', this.finish, !shouldSucceed);\n    };\n\n    this.validateFinishAndSubmit = (\n    shouldBeValid,\n    submitShouldSucceedIfValid) =>\n    {\n      const commandBuffer = this.validateFinish(shouldBeValid);\n      if (shouldBeValid) {\n        t.expectValidationError(() => globalThis._TRAMPOLINE_(\"submit\", t, t.queue.submit, [[commandBuffer]], () => t.queue.submit([commandBuffer])), !submitShouldSucceedIfValid);\n      }\n    };\n\n    this.validateFinishAndSubmitGivenState = (resourceState) => {\n      this.validateFinishAndSubmit(resourceState !== 'invalid', resourceState !== 'destroyed');\n    };\n  }\n}"],"mappings":";;IAAA;AACA;AACA,GAAG,OAAO,MAAMA,kBAAkB,GAAG,CAAC,aAAa,EAAE,eAAe,CAAC,CAErE,OAAO,MAAMC,yBAAyB,GAAG,CAAC,cAAc,EAAE,GAAGD,kBAAkB,CAAC;;AAEhF,OAAO,MAAME,aAAa,GAAG,CAAC,UAAU,EAAE,GAAGD,yBAAyB,CAAC;;;AAGvE;;;;;;;;AAQA;AACA;AACA,OAAO,MAAME,kBAAkB,CAAC;EAC9B;EACA;;;EAGA;AACF;AACA;AACA;;;EAGE;AACF;AACA;AACA;;;EAGE;AACF;AACA;AACA;;;;;;EAME;AACF;AACA;AACA;AACA;;;EAGEC,WAAWA;EACXC,CAAC;EACDC,OAAO;EACPC,MAAM;EACN;IACE;IACA,IAAI,CAACD,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,MAAM,GAAGA,MAAM;;IAEpB;IACA;IACA;IACA;IACA;IACA,IAAI,CAACC,cAAc,GAAG,CAACC,aAAa,KAAK;MACvC,OAAOJ,CAAC,CAACK,cAAc,CAAC,YAAY,EAAE,IAAI,CAACH,MAAM,EAAE,CAACE,aAAa,CAAC;IACpE,CAAC;;IAED,IAAI,CAACE,uBAAuB,GAAG;IAC/BC,aAAa;IACbC,0BAA0B;IAC1B;MACE,MAAMC,aAAa,GAAG,IAAI,CAACN,cAAc,CAACI,aAAa,CAAC;MACxD,IAAIA,aAAa,EAAE;QACjBP,CAAC,CAACU,qBAAqB,CAAC,MAAMC,UAAU,CAACC,YAAY,CAAC,QAAQ,EAAEZ,CAAC,EAAEA,CAAC,CAACa,KAAK,CAACC,MAAM,EAAE,CAAC,CAACL,aAAa,CAAC,CAAC,EAAE,MAAAE,UAAA,CAAAC,YAAA,WAAMZ,CAAC,EAADA,CAAC,CAACa,KAAK,CAAAC,MAAA,GAAQ,CAACL,aAAa,CAAC,SAA9BT,CAAC,CAACa,KAAK,CAACC,MAAM,CAAC,CAACL,aAAa,CAAC,EAAC,CAAC,EAAE,CAACD,0BAA0B,CAAC;MAC5K;IACF,CAAC;;IAED,IAAI,CAACO,iCAAiC,GAAG,CAACC,aAAa,KAAK;MAC1D,IAAI,CAACV,uBAAuB,CAACU,aAAa,KAAK,SAAS,EAAEA,aAAa,KAAK,WAAW,CAAC;IAC1F,CAAC;EACH;AACF","ignoreList":[]}