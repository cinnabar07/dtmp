{"version":3,"file":"memory.js","names":["exhaustVramUntilUnder64MB","t","allocateUntilOom","device","size","buffers","pushErrorScope","buffer","createBufferTracked","usage","GPUBufferUsage","STORAGE","popErrorScope","push","kLargeChunkSize","kSmallChunkSize","forEach","globalThis","_TRAMPOLINE_","destroy"],"sources":["../../../src/webgpu/util/memory.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/ /**\n * Helper to exhaust VRAM until there is less than 64 MB of capacity. Returns\n * an opaque closure which can be called to free the allocated resources later.\n */\nexport async function exhaustVramUntilUnder64MB(t) {\n  const allocateUntilOom = async (device, size) => {\n    const buffers = [];\n    for (;;) {\n      device.pushErrorScope('out-of-memory');\n      const buffer = t.createBufferTracked({ size, usage: GPUBufferUsage.STORAGE });\n      if (await device.popErrorScope()) {\n        return buffers;\n      }\n      buffers.push(buffer);\n    }\n  };\n\n  const kLargeChunkSize = 512 * 1024 * 1024;\n  const kSmallChunkSize = 64 * 1024 * 1024;\n  const buffers = await allocateUntilOom(t.device, kLargeChunkSize);\n  buffers.push(...(await allocateUntilOom(t.device, kSmallChunkSize)));\n  return () => {\n    buffers.forEach((buffer) => globalThis._TRAMPOLINE_(\"destroy\", buffer, buffer.destroy, [], () => buffer.destroy()));\n  };\n}"],"mappings":";;IAAA;AACA;AACA,GAFA,CAEI;AACJ;AACA;AACA,EACA,OAAO,eAAeA,yBAAyBA,CAACC,CAAC,EAAE,CACjD,MAAMC,gBAAgB,GAAG,MAAAA,CAAOC,MAAM,EAAEC,IAAI,KAAK;IAC/C,MAAMC,OAAO,GAAG,EAAE;IAClB,SAAS;MACPF,MAAM,CAACG,cAAc,CAAC,eAAe,CAAC;MACtC,MAAMC,MAAM,GAAGN,CAAC,CAACO,mBAAmB,CAAC,EAAEJ,IAAI,EAAEK,KAAK,EAAEC,cAAc,CAACC,OAAO,CAAC,CAAC,CAAC;MAC7E,IAAI,MAAMR,MAAM,CAACS,aAAa,CAAC,CAAC,EAAE;QAChC,OAAOP,OAAO;MAChB;MACAA,OAAO,CAACQ,IAAI,CAACN,MAAM,CAAC;IACtB;EACF,CAAC;;EAED,MAAMO,eAAe,GAAG,GAAG,GAAG,IAAI,GAAG,IAAI;EACzC,MAAMC,eAAe,GAAG,EAAE,GAAG,IAAI,GAAG,IAAI;EACxC,MAAMV,OAAO,GAAG,MAAMH,gBAAgB,CAACD,CAAC,CAACE,MAAM,EAAEW,eAAe,CAAC;EACjET,OAAO,CAACQ,IAAI,CAAC,IAAI,MAAMX,gBAAgB,CAACD,CAAC,CAACE,MAAM,EAAEY,eAAe,CAAC,CAAC,CAAC;EACpE,OAAO,MAAM;IACXV,OAAO,CAACW,OAAO,CAAC,CAACT,MAAM,KAAKU,UAAU,CAACC,YAAY,CAAC,SAAS,EAAEX,MAAM,EAAEA,MAAM,CAACY,OAAO,EAAE,EAAE,EAAE,MAAAF,UAAA,CAAAC,YAAA,YAAMX,MAAM,EAANA,MAAM,CAAAY,OAAA,YAANZ,MAAM,CAACY,OAAO,GAAE,CAAC,CAAC;EACrH,CAAC;AACH","ignoreList":[]}