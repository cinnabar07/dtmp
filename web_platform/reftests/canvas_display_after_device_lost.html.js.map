{"version":3,"file":"canvas_display_after_device_lost.html.js","names":["timeout","assert","takeScreenshotDelayed","navigator","gpu","undefined","adapter","globalThis","_TRAMPOLINE_","requestAdapter","device","requestDevice","presentationFormat","getPreferredCanvasFormat","deviceLost","draw","canvasId","alphaMode","abortAfterDeviceLost","canvas","document","getElementById","ctx","getContext","configure","format","colorAttachment","getCurrentTexture","colorAttachmentView","createView","encoder","createCommandEncoder","pass","beginRenderPass","colorAttachments","view","clearValue","r","g","b","a","loadOp","storeOp","end","queue","submit","finish","drawAll","destroy"],"sources":["../../../../src/webgpu/web_platform/reftests/canvas_display_after_device_lost.html.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/import { timeout } from '../../../common/util/timeout.js';import { assert } from '../../../common/util/util.js';import { takeScreenshotDelayed } from '../../../common/util/wpt_reftest_wait.js';\n\nvoid (async () => {\n  assert(\n    typeof navigator !== 'undefined' && navigator.gpu !== undefined,\n    'No WebGPU implementation found'\n  );\n\n  const adapter = await globalThis._TRAMPOLINE_(\"requestAdapter\", navigator.gpu, navigator.gpu.requestAdapter, [], () => navigator.gpu.requestAdapter());\n  assert(adapter !== null);\n  const device = await globalThis._TRAMPOLINE_(\"requestDevice\", adapter, adapter.requestDevice, [], () => adapter.requestDevice());\n  assert(device !== null);\n  const presentationFormat = navigator.gpu.getPreferredCanvasFormat();\n  let deviceLost = false;\n\n  function draw(canvasId, alphaMode, abortAfterDeviceLost) {\n    if (deviceLost && abortAfterDeviceLost) {\n      return;\n    }\n\n    const canvas = document.getElementById(canvasId);\n    const ctx = canvas.getContext('webgpu');\n    ctx.configure({\n      device,\n      format: presentationFormat,\n      alphaMode\n    });\n\n    const colorAttachment = ctx.getCurrentTexture();\n    const colorAttachmentView = colorAttachment.createView();\n\n    const encoder = globalThis._TRAMPOLINE_(\"createCommandEncoder\", device, device.createCommandEncoder, [], () => device.createCommandEncoder());\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [\n      {\n        view: colorAttachmentView,\n        clearValue: { r: 0.4, g: 1.0, b: 0.0, a: 1.0 },\n        loadOp: 'clear',\n        storeOp: 'store'\n      }]\n\n    });\n    pass.end();\n    globalThis._TRAMPOLINE_(\"submit\", device, device.queue.submit, [[encoder.finish()]], () => device.queue.submit([encoder.finish()]));\n  }\n\n  function drawAll() {\n    draw('cvs0', 'opaque', true);\n    draw('cvs1', 'opaque', false);\n    draw('cvs2', 'premultiplied', true);\n    draw('cvs3', 'premultiplied', false);\n\n    if (!deviceLost) {\n      globalThis._TRAMPOLINE_(\"destroy\", device, device.destroy, [], () => device.destroy());\n      deviceLost = true;\n      timeout(drawAll, 100);\n    } else {\n      takeScreenshotDelayed(50);\n    }\n  }\n\n  drawAll();\n})();"],"mappings":"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","ignoreList":[]}