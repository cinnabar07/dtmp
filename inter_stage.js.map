{"version":3,"file":"inter_stage.js","names":["assert","s_deviceToEitherSamplingIndex","WeakMap","getProvokingVertexForFlatInterpolationEitherSampling","t","device","sampling","get","module","createShaderModule","code","pipeline","createRenderPipeline","layout","vertex","fragment","targets","format","texture","createTextureTracked","size","usage","GPUTextureUsage","RENDER_ATTACHMENT","COPY_SRC","encoder","globalThis","_TRAMPOLINE_","createCommandEncoder","pass","beginRenderPass","colorAttachments","view","createView","clearValue","loadOp","storeOp","setPipeline","draw","end","buffer","createBufferTracked","GPUBufferUsage","COPY_DST","MAP_READ","copyTextureToBuffer","commandBuffer","finish","queue","submit","mapAsync","GPUMapMode","READ","result","Uint8Array","getMappedRange","unmap","destroy","set"],"sources":["../../src/webgpu/inter_stage.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/import { assert } from '../common/util/util.js';\n\n\n\nconst s_deviceToEitherSamplingIndex = new WeakMap();\n\n/**\n * Returns whether the device uses the first or last vertex for the\n * provoking vertex when using @interpolate(flat, either)\n */\nexport async function getProvokingVertexForFlatInterpolationEitherSampling(\nt)\n{\n  const { device } = t;\n  let sampling = s_deviceToEitherSamplingIndex.get(device);\n  if (!sampling) {\n    const module = device.createShaderModule({\n      code: `\n        struct VSOut {\n          @builtin(position) position: vec4f,\n          @location(0) @interpolate(flat, either) vertexIndex: u32,\n        };\n\n        @vertex fn vs(\n          @builtin(vertex_index) vertexIndex : u32,\n        ) -> VSOut {\n          let pos = array(vec2f(-1, 3), vec2f(3, -1), vec2f(-1, -1));\n          var vsOutput: VSOut;\n          vsOutput.position = vec4f(pos[vertexIndex], 0, 1);\n          vsOutput.vertexIndex = vertexIndex;\n          return vsOutput;\n        }\n\n        @fragment fn fs(@location(0) @interpolate(flat, either) vertexIndex: u32) -> @location(0) vec4u {\n          return vec4u(vertexIndex);\n        }\n      `\n    });\n\n    const pipeline = device.createRenderPipeline({\n      layout: 'auto',\n      vertex: {\n        module\n      },\n      fragment: {\n        module,\n        targets: [{ format: 'rgba8uint' }]\n      }\n    });\n\n    const texture = t.createTextureTracked({\n      format: 'rgba8uint',\n      size: [1, 1],\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC\n    });\n\n    const encoder = globalThis._TRAMPOLINE_(\"createCommandEncoder\", device, device.createCommandEncoder, [], () => device.createCommandEncoder());\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [\n      {\n        view: texture.createView(),\n        clearValue: [255, 255, 255, 255],\n        loadOp: 'clear',\n        storeOp: 'store'\n      }]\n\n    });\n    pass.setPipeline(pipeline);\n    pass.draw(3);\n    pass.end();\n\n    const buffer = t.createBufferTracked({\n      size: 4,\n      usage: GPUBufferUsage.COPY_DST | GPUBufferUsage.MAP_READ\n    });\n    encoder.copyTextureToBuffer({ texture }, { buffer }, [1, 1]);\n\n    const commandBuffer = encoder.finish();\n    globalThis._TRAMPOLINE_(\"submit\", device, device.queue.submit, [[commandBuffer]], () => device.queue.submit([commandBuffer]));\n\n    await globalThis._TRAMPOLINE_(\"mapAsync\", buffer, buffer.mapAsync, [GPUMapMode.READ], () => buffer.mapAsync(GPUMapMode.READ));\n    const result = new Uint8Array(buffer.getMappedRange())[0];\n    buffer.unmap();\n    globalThis._TRAMPOLINE_(\"destroy\", buffer, buffer.destroy, [], () => buffer.destroy());\n    globalThis._TRAMPOLINE_(\"destroy\", texture, texture.destroy, [], () => texture.destroy());\n\n    assert(result === 0 || result === 2, `expected result to be 0 or 2, was ${result}`);\n    sampling = result === 2 ? 'last' : 'first';\n    s_deviceToEitherSamplingIndex.set(device, sampling);\n  }\n  return sampling;\n}"],"mappings":"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","ignoreList":[]}