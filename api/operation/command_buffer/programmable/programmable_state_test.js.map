{"version":3,"file":"programmable_state_test.js","names":["unreachable","GPUTest","ProgrammableStateTest","commonBindGroupLayouts","Map","getBindGroupLayout","type","has","set","device","createBindGroupLayout","entries","binding","visibility","GPUShaderStage","COMPUTE","FRAGMENT","buffer","get","getBindGroupLayouts","indices","bindGroupLayouts","a","b","out","createBindGroup","layout","resource","setBindGroup","encoder","index","factory","createBindingStatePipeline","encoderType","groups","algorithm","wgsl","createComputePipeline","createPipelineLayout","compute","module","createShaderModule","code","entryPoint","wgslShaders","vertex","fragment","createRenderPipeline","targets","format","primitive","topology","setPipeline","pass","pipeline","GPUComputePassEncoder","GPURenderPassEncoder","GPURenderBundleEncoder","dispatchOrDraw","dispatchWorkgroups","draw"],"sources":["../../../../../../src/webgpu/api/operation/command_buffer/programmable/programmable_state_test.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/import { unreachable } from '../../../../../common/util/util.js';import { GPUTest } from '../../../../gpu_test.js';\n\n\n\n\n\n\n\nexport class ProgrammableStateTest extends GPUTest {\n  commonBindGroupLayouts = new Map();\n\n  getBindGroupLayout(type) {\n    if (!this.commonBindGroupLayouts.has(type)) {\n      this.commonBindGroupLayouts.set(\n        type,\n        this.device.createBindGroupLayout({\n          entries: [\n          {\n            binding: 0,\n            visibility: GPUShaderStage.COMPUTE | GPUShaderStage.FRAGMENT,\n            buffer: { type }\n          }]\n\n        })\n      );\n    }\n    return this.commonBindGroupLayouts.get(type);\n  }\n\n  getBindGroupLayouts(indices) {\n    const bindGroupLayouts = [];\n    bindGroupLayouts[indices.a] = this.getBindGroupLayout('read-only-storage');\n    bindGroupLayouts[indices.b] = this.getBindGroupLayout('read-only-storage');\n    bindGroupLayouts[indices.out] = this.getBindGroupLayout('storage');\n    return bindGroupLayouts;\n  }\n\n  createBindGroup(buffer, type) {\n    return this.device.createBindGroup({\n      layout: this.getBindGroupLayout(type),\n      entries: [{ binding: 0, resource: { buffer } }]\n    });\n  }\n\n  setBindGroup(\n  encoder,\n  index,\n  factory)\n  {\n    encoder.setBindGroup(index, factory(index));\n  }\n\n  // Create a compute pipeline that performs an operation on data from two bind groups,\n  // then writes the result to a third bind group.\n  createBindingStatePipeline(\n  encoderType,\n  groups,\n  algorithm = 'a.value - b.value')\n  {\n    switch (encoderType) {\n      case 'compute pass':{\n          const wgsl = `struct Data {\n            value : i32\n          };\n\n          @group(${groups.a}) @binding(0) var<storage> a : Data;\n          @group(${groups.b}) @binding(0) var<storage> b : Data;\n          @group(${groups.out}) @binding(0) var<storage, read_write> out : Data;\n\n          @compute @workgroup_size(1) fn main() {\n            out.value = ${algorithm};\n            return;\n          }\n        `;\n\n          return this.device.createComputePipeline({\n            layout: this.device.createPipelineLayout({\n              bindGroupLayouts: this.getBindGroupLayouts(groups)\n            }),\n            compute: {\n              module: this.device.createShaderModule({\n                code: wgsl\n              }),\n              entryPoint: 'main'\n            }\n          });\n        }\n      case 'render pass':\n      case 'render bundle':{\n          const wgslShaders = {\n            vertex: `\n            @vertex fn vert_main() -> @builtin(position) vec4<f32> {\n              return vec4<f32>(0.5, 0.5, 0.0, 1.0);\n            }\n          `,\n\n            fragment: `\n            struct Data {\n              value : i32\n            };\n\n            @group(${groups.a}) @binding(0) var<storage> a : Data;\n            @group(${groups.b}) @binding(0) var<storage> b : Data;\n            @group(${groups.out}) @binding(0) var<storage, read_write> out : Data;\n\n            @fragment fn frag_main() -> @location(0) vec4<f32> {\n              out.value = ${algorithm};\n              return vec4<f32>(1.0, 0.0, 0.0, 1.0);\n            }\n          `\n          };\n\n          return this.device.createRenderPipeline({\n            layout: this.device.createPipelineLayout({\n              bindGroupLayouts: this.getBindGroupLayouts(groups)\n            }),\n            vertex: {\n              module: this.device.createShaderModule({\n                code: wgslShaders.vertex\n              }),\n              entryPoint: 'vert_main'\n            },\n            fragment: {\n              module: this.device.createShaderModule({\n                code: wgslShaders.fragment\n              }),\n              entryPoint: 'frag_main',\n              targets: [{ format: 'rgba8unorm' }]\n            },\n            primitive: { topology: 'point-list' }\n          });\n        }\n      default:\n        unreachable();\n    }\n  }\n\n  setPipeline(pass, pipeline) {\n    if (pass instanceof GPUComputePassEncoder) {\n      pass.setPipeline(pipeline);\n    } else if (pass instanceof GPURenderPassEncoder || pass instanceof GPURenderBundleEncoder) {\n      pass.setPipeline(pipeline);\n    }\n  }\n\n  dispatchOrDraw(pass) {\n    if (pass instanceof GPUComputePassEncoder) {\n      pass.dispatchWorkgroups(1);\n    } else if (pass instanceof GPURenderPassEncoder) {\n      pass.draw(1);\n    } else if (pass instanceof GPURenderBundleEncoder) {\n      pass.draw(1);\n    }\n  }\n}"],"mappings":"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","ignoreList":[]}