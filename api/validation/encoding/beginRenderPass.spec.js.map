{"version":3,"file":"beginRenderPass.spec.js","names":["description","makeTestGroup","ValidationTest","g","test","desc","paramsSubcasesOnly","view0Mismatched","target0Mismatched","view1Mismatched","target1Mismatched","beforeAllSubcases","t","selectMismatchedDeviceOrSkipTestCase","undefined","fn","params","mismatched","view0Texture","getDeviceMismatchedRenderTexture","getRenderTexture","target0Texture","view1Texture","target1Texture","encoder","createEncoder","pass","beginRenderPass","colorAttachments","view","createView","clearValue","r","b","a","loadOp","storeOp","resolveTarget","end","validateFinish","u","combine","descriptor","size","width","height","depthOrArrayLayers","format","usage","GPUTextureUsage","RENDER_ATTACHMENT","depthStencilTexture","getDeviceMismatchedTexture","createTextureTracked","depthStencilAttachment","depthClearValue","depthLoadOp","depthStoreOp","stencilClearValue","stencilLoadOp","stencilStoreOp","sourceDevice","mismatchedDevice","device","occlusionQuerySet","trackForCleanup","createQuerySet","type","count","selectDeviceOrSkipTestCase","timestampQuerySet","timestampWrites","querySet","beginningOfPassWriteIndex","colorTexture"],"sources":["../../../../../src/webgpu/api/validation/encoding/beginRenderPass.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nNote: render pass 'occlusionQuerySet' validation is tested in queries/general.spec.ts\n\nTODO: Check that depth-stencil attachment views must encompass all aspects.\n\nTODO: check for duplication (render_pass/, etc.), plan, and implement.\nNote possibly a lot of this should be operation tests instead.\nNotes:\n> - color attachments {zero, one, multiple}\n>     - many different formats (some are non-renderable)\n>     - is a view on a texture with multiple mip levels or array layers\n>     - two attachments use the same view, or views of {intersecting, disjoint} ranges\n>     - {without, with} resolve target\n>         - resolve format compatibility with multisampled format\n>     - {all possible load ops, load color {in range, negative, too large}}\n>     - all possible store ops\n> - depth/stencil attachment\n>     - {unset, all possible formats}\n>     - {all possible {depth, stencil} load ops, load values {in range, negative, too large}}\n>     - all possible {depth, stencil} store ops\n>     - depthReadOnly {t,f}, stencilReadOnly {t,f}\n`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('color_attachments,device_mismatch').\ndesc(\n  `\n    Tests beginRenderPass cannot be called with color attachments whose texture view or resolve target is created from another device\n    The 'view' and 'resolveTarget' are:\n    - created from same device in ColorAttachment0 and ColorAttachment1\n    - created from different device in ColorAttachment0 and ColorAttachment1\n    - created from same device in ColorAttachment0, but from different device in ColorAttachment1\n    `\n).\nparamsSubcasesOnly([\n{\n  view0Mismatched: false,\n  target0Mismatched: false,\n  view1Mismatched: false,\n  target1Mismatched: false\n}, // control case\n{\n  view0Mismatched: false,\n  target0Mismatched: true,\n  view1Mismatched: false,\n  target1Mismatched: true\n},\n{\n  view0Mismatched: true,\n  target0Mismatched: false,\n  view1Mismatched: true,\n  target1Mismatched: false\n},\n{\n  view0Mismatched: false,\n  target0Mismatched: false,\n  view1Mismatched: false,\n  target1Mismatched: true\n}]\n).\nbeforeAllSubcases((t) => {\n  t.selectMismatchedDeviceOrSkipTestCase(undefined);\n}).\nfn((t) => {\n  const { view0Mismatched, target0Mismatched, view1Mismatched, target1Mismatched } = t.params;\n  const mismatched = view0Mismatched || target0Mismatched || view1Mismatched || target1Mismatched;\n\n  const view0Texture = view0Mismatched ?\n  t.getDeviceMismatchedRenderTexture(4) :\n  t.getRenderTexture(4);\n  const target0Texture = target0Mismatched ?\n  t.getDeviceMismatchedRenderTexture() :\n  t.getRenderTexture();\n  const view1Texture = view1Mismatched ?\n  t.getDeviceMismatchedRenderTexture(4) :\n  t.getRenderTexture(4);\n  const target1Texture = target1Mismatched ?\n  t.getDeviceMismatchedRenderTexture() :\n  t.getRenderTexture();\n\n  const encoder = t.createEncoder('non-pass');\n  const pass = encoder.encoder.beginRenderPass({\n    colorAttachments: [\n    {\n      view: view0Texture.createView(),\n      clearValue: { r: 1.0, g: 0.0, b: 0.0, a: 1.0 },\n      loadOp: 'clear',\n      storeOp: 'store',\n      resolveTarget: target0Texture.createView()\n    },\n    {\n      view: view1Texture.createView(),\n      clearValue: { r: 1.0, g: 0.0, b: 0.0, a: 1.0 },\n      loadOp: 'clear',\n      storeOp: 'store',\n      resolveTarget: target1Texture.createView()\n    }]\n\n  });\n  pass.end();\n\n  encoder.validateFinish(!mismatched);\n});\n\ng.test('depth_stencil_attachment,device_mismatch').\ndesc(\n  'Tests beginRenderPass cannot be called with a depth stencil attachment whose texture view is created from another device'\n).\nparamsSubcasesOnly((u) => u.combine('mismatched', [true, false])).\nbeforeAllSubcases((t) => {\n  t.selectMismatchedDeviceOrSkipTestCase(undefined);\n}).\nfn((t) => {\n  const { mismatched } = t.params;\n\n  const descriptor = {\n    size: { width: 4, height: 4, depthOrArrayLayers: 1 },\n    format: 'depth24plus-stencil8',\n    usage: GPUTextureUsage.RENDER_ATTACHMENT\n  };\n\n  const depthStencilTexture = mismatched ?\n  t.getDeviceMismatchedTexture(descriptor) :\n  t.createTextureTracked(descriptor);\n\n  const encoder = t.createEncoder('non-pass');\n  const pass = encoder.encoder.beginRenderPass({\n    colorAttachments: [],\n    depthStencilAttachment: {\n      view: depthStencilTexture.createView(),\n      depthClearValue: 0,\n      depthLoadOp: 'clear',\n      depthStoreOp: 'store',\n      stencilClearValue: 0,\n      stencilLoadOp: 'clear',\n      stencilStoreOp: 'store'\n    }\n  });\n  pass.end();\n\n  encoder.validateFinish(!mismatched);\n});\n\ng.test('occlusion_query_set,device_mismatch').\ndesc(\n  'Tests beginRenderPass cannot be called with an occlusion query set created from another device'\n).\nparamsSubcasesOnly((u) => u.combine('mismatched', [true, false])).\nbeforeAllSubcases((t) => {\n  t.selectMismatchedDeviceOrSkipTestCase(undefined);\n}).\nfn((t) => {\n  const { mismatched } = t.params;\n  const sourceDevice = mismatched ? t.mismatchedDevice : t.device;\n\n  const occlusionQuerySet = t.trackForCleanup(\n    sourceDevice.createQuerySet({\n      type: 'occlusion',\n      count: 1\n    })\n  );\n\n  const encoder = t.createEncoder('render pass', { occlusionQuerySet });\n  encoder.validateFinish(!mismatched);\n});\n\ng.test('timestamp_query_set,device_mismatch').\ndesc(\n  `\n  Tests beginRenderPass cannot be called with a timestamp query set created from another device.\n  `\n).\nparamsSubcasesOnly((u) => u.combine('mismatched', [true, false])).\nbeforeAllSubcases((t) => {\n  t.selectDeviceOrSkipTestCase(['timestamp-query']);\n  t.selectMismatchedDeviceOrSkipTestCase('timestamp-query');\n}).\nfn((t) => {\n  const { mismatched } = t.params;\n  const sourceDevice = mismatched ? t.mismatchedDevice : t.device;\n\n  const timestampQuerySet = t.trackForCleanup(\n    sourceDevice.createQuerySet({\n      type: 'timestamp',\n      count: 1\n    })\n  );\n\n  const timestampWrites = {\n    querySet: timestampQuerySet,\n    beginningOfPassWriteIndex: 0\n  };\n\n  const colorTexture = t.createTextureTracked({\n    format: 'rgba8unorm',\n    size: { width: 4, height: 4, depthOrArrayLayers: 1 },\n    usage: GPUTextureUsage.RENDER_ATTACHMENT\n  });\n\n  const encoder = t.createEncoder('non-pass');\n  const pass = encoder.encoder.beginRenderPass({\n    colorAttachments: [\n    {\n      view: colorTexture.createView(),\n      loadOp: 'load',\n      storeOp: 'store'\n    }],\n\n    timestampWrites\n  });\n  pass.end();\n\n  encoder.validateFinish(!mismatched);\n});"],"mappings":"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","ignoreList":[]}