{"version":3,"file":"destroy.spec.js","names":["description","makeTestGroup","kTextureAspects","kTextureFormatInfo","ValidationTest","g","test","desc","fn","t","texture","getSampledTexture","globalThis","_TRAMPOLINE_","destroy","device","pushErrorScope","invalidTexture","createTextureTracked","size","limits","maxTextureDimension2D","format","usage","GPUTextureUsage","TEXTURE_BINDING","error","popErrorScope","expect","params","u","combine","colorTextureState","depthStencilTextureAspect","depthStencilTextureState","isSubmitSuccess","colorTextureFormat","depthStencilTextureFormat","colorTextureDesc","width","height","depthOrArrayLayers","COPY_DST","RENDER_ATTACHMENT","depthStencilTextureDesc","colorTexture","depthStencilTexture","commandEncoder","createCommandEncoder","depthStencilAttachment","view","createView","aspect","depth","depthClearValue","depthLoadOp","depthStoreOp","stencil","stencilClearValue","stencilLoadOp","stencilStoreOp","renderPass","beginRenderPass","colorAttachments","clearValue","loadOp","storeOp","end","cmd","finish","expectValidationError","queue","submit"],"sources":["../../../../../src/webgpu/api/validation/texture/destroy.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nDestroying a texture more than once is allowed.\n`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { kTextureAspects } from '../../../capability_info.js';\nimport { kTextureFormatInfo } from '../../../format_info.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('base').\ndesc(`Test that it is valid to destroy a texture.`).\nfn((t) => {\n  const texture = t.getSampledTexture();\n  globalThis._TRAMPOLINE_(\"destroy\", texture, texture.destroy, [], () => texture.destroy());\n});\n\ng.test('twice').\ndesc(`Test that it is valid to destroy a destroyed texture.`).\nfn((t) => {\n  const texture = t.getSampledTexture();\n  globalThis._TRAMPOLINE_(\"destroy\", texture, texture.destroy, [], () => texture.destroy());\n  globalThis._TRAMPOLINE_(\"destroy\", texture, texture.destroy, [], () => texture.destroy());\n});\n\ng.test('invalid_texture').\ndesc('Test that invalid textures may be destroyed without generating validation errors.').\nfn(async (t) => {\n  t.device.pushErrorScope('validation');\n\n  const invalidTexture = t.createTextureTracked({\n    size: [t.device.limits.maxTextureDimension2D + 1, 1, 1],\n    format: 'rgba8unorm',\n    usage: GPUTextureUsage.TEXTURE_BINDING\n  });\n\n  // Expect error because it's invalid.\n  const error = await t.device.popErrorScope();\n  t.expect(!!error);\n\n  // This line should not generate an error\n  globalThis._TRAMPOLINE_(\"destroy\", invalidTexture, invalidTexture.destroy, [], () => invalidTexture.destroy());\n});\n\ng.test('submit_a_destroyed_texture_as_attachment').\ndesc(\n  `\nTest that it is invalid to submit with a texture as {color, depth, stencil, depth-stencil} attachment\nthat was destroyed {before, after} encoding finishes.\n`\n).\nparams((u) =>\nu //\n.combine('depthStencilTextureAspect', kTextureAspects).\ncombine('colorTextureState', [\n'valid',\n'destroyedBeforeEncode',\n'destroyedAfterEncode']\n).\ncombine('depthStencilTextureState', [\n'valid',\n'destroyedBeforeEncode',\n'destroyedAfterEncode']\n)\n).\nfn((t) => {\n  const { colorTextureState, depthStencilTextureAspect, depthStencilTextureState } = t.params;\n\n  const isSubmitSuccess = colorTextureState === 'valid' && depthStencilTextureState === 'valid';\n\n  const colorTextureFormat = 'rgba32float';\n  const depthStencilTextureFormat =\n  depthStencilTextureAspect === 'all' ?\n  'depth24plus-stencil8' :\n  depthStencilTextureAspect === 'depth-only' ?\n  'depth32float' :\n  'stencil8';\n\n  const colorTextureDesc = {\n    size: { width: 16, height: 16, depthOrArrayLayers: 1 },\n    format: colorTextureFormat,\n    usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT\n  };\n\n  const depthStencilTextureDesc = {\n    size: { width: 16, height: 16, depthOrArrayLayers: 1 },\n    format: depthStencilTextureFormat,\n    usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT\n  };\n\n  const colorTexture = t.createTextureTracked(colorTextureDesc);\n  const depthStencilTexture = t.createTextureTracked(depthStencilTextureDesc);\n\n  if (colorTextureState === 'destroyedBeforeEncode') {\n    globalThis._TRAMPOLINE_(\"destroy\", colorTexture, colorTexture.destroy, [], () => colorTexture.destroy());\n  }\n  if (depthStencilTextureState === 'destroyedBeforeEncode') {\n    globalThis._TRAMPOLINE_(\"destroy\", depthStencilTexture, depthStencilTexture.destroy, [], () => depthStencilTexture.destroy());\n  }\n\n  const commandEncoder = globalThis._TRAMPOLINE_(\"createCommandEncoder\", t.device, t.device.createCommandEncoder, [], () => t.device.createCommandEncoder());\n  const depthStencilAttachment = {\n    view: depthStencilTexture.createView({ aspect: depthStencilTextureAspect })\n  };\n  if (kTextureFormatInfo[depthStencilTextureFormat].depth) {\n    depthStencilAttachment.depthClearValue = 0;\n    depthStencilAttachment.depthLoadOp = 'clear';\n    depthStencilAttachment.depthStoreOp = 'discard';\n  }\n  if (kTextureFormatInfo[depthStencilTextureFormat].stencil) {\n    depthStencilAttachment.stencilClearValue = 0;\n    depthStencilAttachment.stencilLoadOp = 'clear';\n    depthStencilAttachment.stencilStoreOp = 'discard';\n  }\n  const renderPass = commandEncoder.beginRenderPass({\n    colorAttachments: [\n    {\n      view: colorTexture.createView(),\n      clearValue: [0, 0, 0, 0],\n      loadOp: 'clear',\n      storeOp: 'store'\n    }],\n\n    depthStencilAttachment\n  });\n  renderPass.end();\n\n  const cmd = commandEncoder.finish();\n\n  if (colorTextureState === 'destroyedAfterEncode') {\n    globalThis._TRAMPOLINE_(\"destroy\", colorTexture, colorTexture.destroy, [], () => colorTexture.destroy());\n  }\n  if (depthStencilTextureState === 'destroyedAfterEncode') {\n    globalThis._TRAMPOLINE_(\"destroy\", depthStencilTexture, depthStencilTexture.destroy, [], () => depthStencilTexture.destroy());\n  }\n\n  t.expectValidationError(() => globalThis._TRAMPOLINE_(\"submit\", t, t.queue.submit, [[cmd]], () => t.queue.submit([cmd])), !isSubmitSuccess);\n});"],"mappings":";;IAAA;AACA;AACA,GAAG,OAAO,MAAMA,WAAW,GAAG;AAC9B;AACA,CAAC,CAAC,SAASC,aAAa,QAAQ,4CAA4C,CAC5E,SAASC,eAAe,QAAQ,6BAA6B,CAC7D,SAASC,kBAAkB,QAAQ,yBAAyB;AAC5D,SAASC,cAAc,QAAQ,uBAAuB;;AAEtD,OAAO,MAAMC,CAAC,GAAGJ,aAAa,CAACG,cAAc,CAAC;;AAE9CC,CAAC,CAACC,IAAI,CAAC,MAAM,CAAC;AACdC,IAAI,CAAC,6CAA6C,CAAC;AACnDC,EAAE,CAAC,CAACC,CAAC,KAAK;EACR,MAAMC,OAAO,GAAGD,CAAC,CAACE,iBAAiB,CAAC,CAAC;EACrCC,UAAU,CAACC,YAAY,CAAC,SAAS,EAAEH,OAAO,EAAEA,OAAO,CAACI,OAAO,EAAE,EAAE,EAAE,MAAAF,UAAA,CAAAC,YAAA,YAAMH,OAAO,EAAPA,OAAO,CAAAI,OAAA,YAAPJ,OAAO,CAACI,OAAO,GAAE,CAAC;AAC3F,CAAC,CAAC;;AAEFT,CAAC,CAACC,IAAI,CAAC,OAAO,CAAC;AACfC,IAAI,CAAC,uDAAuD,CAAC;AAC7DC,EAAE,CAAC,CAACC,CAAC,KAAK;EACR,MAAMC,OAAO,GAAGD,CAAC,CAACE,iBAAiB,CAAC,CAAC;EACrCC,UAAU,CAACC,YAAY,CAAC,SAAS,EAAEH,OAAO,EAAEA,OAAO,CAACI,OAAO,EAAE,EAAE,EAAE,MAAAF,UAAA,CAAAC,YAAA,YAAMH,OAAO,EAAPA,OAAO,CAAAI,OAAA,YAAPJ,OAAO,CAACI,OAAO,GAAE,CAAC;EACzFF,UAAU,CAACC,YAAY,CAAC,SAAS,EAAEH,OAAO,EAAEA,OAAO,CAACI,OAAO,EAAE,EAAE,EAAE,MAAAF,UAAA,CAAAC,YAAA,YAAMH,OAAO,EAAPA,OAAO,CAAAI,OAAA,YAAPJ,OAAO,CAACI,OAAO,GAAE,CAAC;AAC3F,CAAC,CAAC;;AAEFT,CAAC,CAACC,IAAI,CAAC,iBAAiB,CAAC;AACzBC,IAAI,CAAC,mFAAmF,CAAC;AACzFC,EAAE,CAAC,OAAOC,CAAC,KAAK;EACdA,CAAC,CAACM,MAAM,CAACC,cAAc,CAAC,YAAY,CAAC;;EAErC,MAAMC,cAAc,GAAGR,CAAC,CAACS,oBAAoB,CAAC;IAC5CC,IAAI,EAAE,CAACV,CAAC,CAACM,MAAM,CAACK,MAAM,CAACC,qBAAqB,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;IACvDC,MAAM,EAAE,YAAY;IACpBC,KAAK,EAAEC,eAAe,CAACC;EACzB,CAAC,CAAC;;EAEF;EACA,MAAMC,KAAK,GAAG,MAAMjB,CAAC,CAACM,MAAM,CAACY,aAAa,CAAC,CAAC;EAC5ClB,CAAC,CAACmB,MAAM,CAAC,CAAC,CAACF,KAAK,CAAC;;EAEjB;EACAd,UAAU,CAACC,YAAY,CAAC,SAAS,EAAEI,cAAc,EAAEA,cAAc,CAACH,OAAO,EAAE,EAAE,EAAE,MAAAF,UAAA,CAAAC,YAAA,YAAMI,cAAc,EAAdA,cAAc,CAAAH,OAAA,YAAdG,cAAc,CAACH,OAAO,GAAE,CAAC;AAChH,CAAC,CAAC;;AAEFT,CAAC,CAACC,IAAI,CAAC,0CAA0C,CAAC;AAClDC,IAAI;EACF;AACF;AACA;AACA;AACA,CAAC;AACDsB,MAAM,CAAC,CAACC,CAAC;AACTA,CAAC,CAAC;AAAA,CACDC,OAAO,CAAC,2BAA2B,EAAE7B,eAAe,CAAC;AACtD6B,OAAO,CAAC,mBAAmB,EAAE;AAC7B,OAAO;AACP,uBAAuB;AACvB,sBAAsB;AACtB,CAAC;AACDA,OAAO,CAAC,0BAA0B,EAAE;AACpC,OAAO;AACP,uBAAuB;AACvB,sBAAsB;AACtB;AACA,CAAC;AACDvB,EAAE,CAAC,CAACC,CAAC,KAAK;EACR,MAAM,EAAEuB,iBAAiB,EAAEC,yBAAyB,EAAEC,wBAAwB,CAAC,CAAC,GAAGzB,CAAC,CAACoB,MAAM;;EAE3F,MAAMM,eAAe,GAAGH,iBAAiB,KAAK,OAAO,IAAIE,wBAAwB,KAAK,OAAO;;EAE7F,MAAME,kBAAkB,GAAG,aAAa;EACxC,MAAMC,yBAAyB;EAC/BJ,yBAAyB,KAAK,KAAK;EACnC,sBAAsB;EACtBA,yBAAyB,KAAK,YAAY;EAC1C,cAAc;EACd,UAAU;;EAEV,MAAMK,gBAAgB,GAAG;IACvBnB,IAAI,EAAE,EAAEoB,KAAK,EAAE,EAAE,EAAEC,MAAM,EAAE,EAAE,EAAEC,kBAAkB,EAAE,CAAC,CAAC,CAAC;IACtDnB,MAAM,EAAEc,kBAAkB;IAC1Bb,KAAK,EAAEC,eAAe,CAACkB,QAAQ,GAAGlB,eAAe,CAACmB;EACpD,CAAC;;EAED,MAAMC,uBAAuB,GAAG;IAC9BzB,IAAI,EAAE,EAAEoB,KAAK,EAAE,EAAE,EAAEC,MAAM,EAAE,EAAE,EAAEC,kBAAkB,EAAE,CAAC,CAAC,CAAC;IACtDnB,MAAM,EAAEe,yBAAyB;IACjCd,KAAK,EAAEC,eAAe,CAACkB,QAAQ,GAAGlB,eAAe,CAACmB;EACpD,CAAC;;EAED,MAAME,YAAY,GAAGpC,CAAC,CAACS,oBAAoB,CAACoB,gBAAgB,CAAC;EAC7D,MAAMQ,mBAAmB,GAAGrC,CAAC,CAACS,oBAAoB,CAAC0B,uBAAuB,CAAC;;EAE3E,IAAIZ,iBAAiB,KAAK,uBAAuB,EAAE;IACjDpB,UAAU,CAACC,YAAY,CAAC,SAAS,EAAEgC,YAAY,EAAEA,YAAY,CAAC/B,OAAO,EAAE,EAAE,EAAE,MAAAF,UAAA,CAAAC,YAAA,YAAMgC,YAAY,EAAZA,YAAY,CAAA/B,OAAA,YAAZ+B,YAAY,CAAC/B,OAAO,GAAE,CAAC;EAC1G;EACA,IAAIoB,wBAAwB,KAAK,uBAAuB,EAAE;IACxDtB,UAAU,CAACC,YAAY,CAAC,SAAS,EAAEiC,mBAAmB,EAAEA,mBAAmB,CAAChC,OAAO,EAAE,EAAE,EAAE,MAAAF,UAAA,CAAAC,YAAA,YAAMiC,mBAAmB,EAAnBA,mBAAmB,CAAAhC,OAAA,YAAnBgC,mBAAmB,CAAChC,OAAO,GAAE,CAAC;EAC/H;;EAEA,MAAMiC,cAAc,GAAGnC,UAAU,CAACC,YAAY,CAAC,sBAAsB,EAAEJ,CAAC,CAACM,MAAM,EAAEN,CAAC,CAACM,MAAM,CAACiC,oBAAoB,EAAE,EAAE,EAAE,MAAApC,UAAA,CAAAC,YAAA,yBAAMJ,CAAC,CAACM,MAAM,EAARN,CAAC,CAACM,MAAM,CAAAiC,oBAAA,YAARvC,CAAC,CAACM,MAAM,CAACiC,oBAAoB,GAAE,CAAC;EAC1J,MAAMC,sBAAsB,GAAG;IAC7BC,IAAI,EAAEJ,mBAAmB,CAACK,UAAU,CAAC,EAAEC,MAAM,EAAEnB,yBAAyB,CAAC,CAAC;EAC5E,CAAC;EACD,IAAI9B,kBAAkB,CAACkC,yBAAyB,CAAC,CAACgB,KAAK,EAAE;IACvDJ,sBAAsB,CAACK,eAAe,GAAG,CAAC;IAC1CL,sBAAsB,CAACM,WAAW,GAAG,OAAO;IAC5CN,sBAAsB,CAACO,YAAY,GAAG,SAAS;EACjD;EACA,IAAIrD,kBAAkB,CAACkC,yBAAyB,CAAC,CAACoB,OAAO,EAAE;IACzDR,sBAAsB,CAACS,iBAAiB,GAAG,CAAC;IAC5CT,sBAAsB,CAACU,aAAa,GAAG,OAAO;IAC9CV,sBAAsB,CAACW,cAAc,GAAG,SAAS;EACnD;EACA,MAAMC,UAAU,GAAGd,cAAc,CAACe,eAAe,CAAC;IAChDC,gBAAgB,EAAE;IAClB;MACEb,IAAI,EAAEL,YAAY,CAACM,UAAU,CAAC,CAAC;MAC/Ba,UAAU,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;MACxBC,MAAM,EAAE,OAAO;MACfC,OAAO,EAAE;IACX,CAAC,CAAC;;IAEFjB;EACF,CAAC,CAAC;EACFY,UAAU,CAACM,GAAG,CAAC,CAAC;;EAEhB,MAAMC,GAAG,GAAGrB,cAAc,CAACsB,MAAM,CAAC,CAAC;;EAEnC,IAAIrC,iBAAiB,KAAK,sBAAsB,EAAE;IAChDpB,UAAU,CAACC,YAAY,CAAC,SAAS,EAAEgC,YAAY,EAAEA,YAAY,CAAC/B,OAAO,EAAE,EAAE,EAAE,MAAAF,UAAA,CAAAC,YAAA,YAAMgC,YAAY,EAAZA,YAAY,CAAA/B,OAAA,YAAZ+B,YAAY,CAAC/B,OAAO,GAAE,CAAC;EAC1G;EACA,IAAIoB,wBAAwB,KAAK,sBAAsB,EAAE;IACvDtB,UAAU,CAACC,YAAY,CAAC,SAAS,EAAEiC,mBAAmB,EAAEA,mBAAmB,CAAChC,OAAO,EAAE,EAAE,EAAE,MAAAF,UAAA,CAAAC,YAAA,YAAMiC,mBAAmB,EAAnBA,mBAAmB,CAAAhC,OAAA,YAAnBgC,mBAAmB,CAAChC,OAAO,GAAE,CAAC;EAC/H;;EAEAL,CAAC,CAAC6D,qBAAqB,CAAC,MAAM1D,UAAU,CAACC,YAAY,CAAC,QAAQ,EAAEJ,CAAC,EAAEA,CAAC,CAAC8D,KAAK,CAACC,MAAM,EAAE,CAAC,CAACJ,GAAG,CAAC,CAAC,EAAE,MAAAxD,UAAA,CAAAC,YAAA,WAAMJ,CAAC,EAADA,CAAC,CAAC8D,KAAK,CAAAC,MAAA,GAAQ,CAACJ,GAAG,CAAC,SAApB3D,CAAC,CAAC8D,KAAK,CAACC,MAAM,CAAC,CAACJ,GAAG,CAAC,EAAC,CAAC,EAAE,CAACjC,eAAe,CAAC;AAC7I,CAAC,CAAC","ignoreList":[]}