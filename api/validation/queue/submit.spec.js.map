{"version":3,"file":"submit.spec.js","names":["description","makeTestGroup","ValidationTest","F","createCommandBuffer","options","device","cb","expectValidationError","encoder","globalThis","_TRAMPOLINE_","createCommandEncoder","valid","popDebugGroup","finish","g","test","desc","paramsSubcasesOnly","cb0Mismatched","cb1Mismatched","beforeAllSubcases","t","selectMismatchedDeviceOrSkipTestCase","undefined","fn","params","mismatched","cb0","mismatchedDevice","cb1","queue","submit","cb1_invalid","cb2","cb2_invalid"],"sources":["../../../../../src/webgpu/api/validation/queue/submit.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nTests submit validation.\n\nNote: destroyed buffer/texture/querySet are tested in destroyed/. (unless it gets moved here)\nNote: buffer map state is tested in ./buffer_mapped.spec.ts.\n`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ValidationTest } from '../validation_test.js';\n\n\n\n\n\n\nclass F extends ValidationTest {\n  createCommandBuffer(options = {}) {\n    const device = options.device ?? this.device;\n\n    let cb;\n\n    this.expectValidationError(() => {\n      const encoder = globalThis._TRAMPOLINE_(\"createCommandEncoder\", device, device.createCommandEncoder, [], () => device.createCommandEncoder());\n      if (options.valid === false) {\n        // Popping a debug group when none are pushed results in an invalid command buffer.\n        encoder.popDebugGroup();\n      }\n      cb = encoder.finish();\n    }, options.valid === false);\n\n    return cb;\n  }\n}\n\nexport const g = makeTestGroup(F);\n\ng.test('command_buffer,device_mismatch').\ndesc(\n  `\n    Tests submit cannot be called with command buffers created from another device\n    Test with two command buffers to make sure all command buffers can be validated:\n    - cb0 and cb1 from same device\n    - cb0 and cb1 from different device\n    `\n).\nparamsSubcasesOnly([\n{ cb0Mismatched: false, cb1Mismatched: false }, // control case\n{ cb0Mismatched: true, cb1Mismatched: false },\n{ cb0Mismatched: false, cb1Mismatched: true }]\n).\nbeforeAllSubcases((t) => {\n  t.selectMismatchedDeviceOrSkipTestCase(undefined);\n}).\nfn((t) => {\n  const { cb0Mismatched, cb1Mismatched } = t.params;\n  const mismatched = cb0Mismatched || cb1Mismatched;\n\n  const cb0 = t.createCommandBuffer({ device: cb0Mismatched ? t.mismatchedDevice : t.device });\n  const cb1 = t.createCommandBuffer({ device: cb1Mismatched ? t.mismatchedDevice : t.device });\n\n  t.expectValidationError(() => {\n    globalThis._TRAMPOLINE_(\"submit\", t.device, t.device.queue.submit, [[cb0, cb1]], () => t.device.queue.submit([cb0, cb1]));\n  }, mismatched);\n});\n\ng.test('command_buffer,duplicate_buffers').\ndesc(\n  `\n    Tests submit cannot be called with the same command buffer listed multiple times:\n    `\n).\nfn((t) => {\n  const cb = t.createCommandBuffer();\n\n  t.expectValidationError(() => {\n    globalThis._TRAMPOLINE_(\"submit\", t.device, t.device.queue.submit, [[cb, cb]], () => t.device.queue.submit([cb, cb]));\n  }, true);\n});\n\ng.test('command_buffer,submit_invalidates').\ndesc(\n  `\n    Tests that calling submit invalidates the command buffers passed to it:\n    `\n).\nfn((t) => {\n  const cb = t.createCommandBuffer();\n\n  // Initial submit of a valid command buffer should pass.\n  globalThis._TRAMPOLINE_(\"submit\", t.device, t.device.queue.submit, [[cb]], () => t.device.queue.submit([cb]));\n\n  // Subsequent submits of the same command buffer should fail.\n  t.expectValidationError(() => {\n    globalThis._TRAMPOLINE_(\"submit\", t.device, t.device.queue.submit, [[cb]], () => t.device.queue.submit([cb]));\n  });\n});\n\ng.test('command_buffer,invalid_submit_invalidates').\ndesc(\n  `\n    Tests that calling submit invalidates all command buffers passed to it, even\n    if they're part of an invalid submit.\n    `\n).\nfn((t) => {\n  const cb1 = t.createCommandBuffer();\n  const cb1_invalid = t.createCommandBuffer({ valid: false });\n\n  // Submit should fail because on of the command buffers is invalid\n  t.expectValidationError(() => {\n    globalThis._TRAMPOLINE_(\"submit\", t.device, t.device.queue.submit, [[cb1, cb1_invalid]], () => t.device.queue.submit([cb1, cb1_invalid]));\n  });\n\n  // Subsequent submits of the previously valid command buffer should fail.\n  t.expectValidationError(() => {\n    globalThis._TRAMPOLINE_(\"submit\", t.device, t.device.queue.submit, [[cb1]], () => t.device.queue.submit([cb1]));\n  });\n\n  // The order of the invalid and valid command buffers in the submit array should not matter.\n  const cb2 = t.createCommandBuffer();\n  const cb2_invalid = t.createCommandBuffer({ valid: false });\n\n  t.expectValidationError(() => {\n    globalThis._TRAMPOLINE_(\"submit\", t.device, t.device.queue.submit, [[cb2_invalid, cb2]], () => t.device.queue.submit([cb2_invalid, cb2]));\n  });\n  t.expectValidationError(() => {\n    globalThis._TRAMPOLINE_(\"submit\", t.device, t.device.queue.submit, [[cb2]], () => t.device.queue.submit([cb2]));\n  });\n});"],"mappings":"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","ignoreList":[]}