{"version":3,"file":"misc.spec.js","names":["description","makeTestGroup","kDefaultVertexShaderCode","kDefaultFragmentShaderCode","CreateRenderPipelineValidationTest","g","test","desc","params","u","combine","fn","t","isAsync","descriptor","getDescriptor","doCreateRenderPipelineTest","noFragment","depthStencil","undefined","beginSubcases","unless","depthStencilFormat","hasColor","depthStencilState","format","depthWriteEnabled","depthCompare","targets","paramsSubcasesOnly","beforeAllSubcases","selectMismatchedDeviceOrSkipTestCase","mismatched","sourceDevice","mismatchedDevice","device","layout","createPipelineLayout","bindGroupLayouts","vertex","module","createShaderModule","code","entryPoint","fragment","shader"],"sources":["../../../../../src/webgpu/api/validation/render_pipeline/misc.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nmisc createRenderPipeline and createRenderPipelineAsync validation tests.\n`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { kDefaultVertexShaderCode, kDefaultFragmentShaderCode } from '../../../util/shader.js';\n\nimport { CreateRenderPipelineValidationTest } from './common.js';\n\nexport const g = makeTestGroup(CreateRenderPipelineValidationTest);\n\ng.test('basic').\ndesc(`Test basic usage of createRenderPipeline.`).\nparams((u) => u.combine('isAsync', [false, true])).\nfn((t) => {\n  const { isAsync } = t.params;\n  const descriptor = t.getDescriptor();\n\n  t.doCreateRenderPipelineTest(isAsync, true, descriptor);\n});\n\ng.test('no_attachment').\ndesc(`Test that createRenderPipeline fails without any attachment.`).\nparams((u) => u.combine('isAsync', [false, true])).\nfn((t) => {\n  const { isAsync } = t.params;\n\n  const descriptor = t.getDescriptor({\n    noFragment: true,\n    depthStencil: undefined\n  });\n\n  t.doCreateRenderPipelineTest(isAsync, false, descriptor);\n});\n\ng.test('vertex_state_only').\ndesc(\n  `Tests creating vertex-state-only render pipeline. A vertex-only render pipeline has no fragment\nstate (and thus has no color state), and must have a depth-stencil state as an attachment is required.`\n).\nparams((u) =>\nu.\ncombine('isAsync', [false, true]).\nbeginSubcases().\ncombine('depthStencilFormat', [\n'depth24plus',\n'depth24plus-stencil8',\n'depth32float',\n'']\n).\ncombine('hasColor', [false, true]).\nunless(({ depthStencilFormat, hasColor }) => {\n  // Render pipeline needs at least one attachement\n  return hasColor === false && depthStencilFormat === '';\n})\n).\nfn((t) => {\n  const { isAsync, depthStencilFormat, hasColor } = t.params;\n\n  let depthStencilState;\n  if (depthStencilFormat === '') {\n    depthStencilState = undefined;\n  } else {\n    depthStencilState = {\n      format: depthStencilFormat,\n      depthWriteEnabled: false,\n      depthCompare: 'always'\n    };\n  }\n\n  // Having targets or not should have no effect in result, since it will not appear in the\n  // descriptor in vertex-only render pipeline\n  const descriptor = t.getDescriptor({\n    noFragment: true,\n    depthStencil: depthStencilState,\n    targets: hasColor ? [{ format: 'rgba8unorm' }] : []\n  });\n\n  t.doCreateRenderPipelineTest(isAsync, depthStencilState !== undefined, descriptor);\n});\n\ng.test('pipeline_layout,device_mismatch').\ndesc(\n  'Tests createRenderPipeline(Async) cannot be called with a pipeline layout created from another device'\n).\nparamsSubcasesOnly((u) => u.combine('isAsync', [true, false]).combine('mismatched', [true, false])).\nbeforeAllSubcases((t) => {\n  t.selectMismatchedDeviceOrSkipTestCase(undefined);\n}).\nfn((t) => {\n  const { isAsync, mismatched } = t.params;\n\n  const sourceDevice = mismatched ? t.mismatchedDevice : t.device;\n\n  const layout = sourceDevice.createPipelineLayout({ bindGroupLayouts: [] });\n\n  const format = 'rgba8unorm';\n  const descriptor = {\n    layout,\n    vertex: {\n      module: t.device.createShaderModule({\n        code: kDefaultVertexShaderCode\n      }),\n      entryPoint: 'main'\n    },\n    fragment: {\n      module: t.device.createShaderModule({\n        code: kDefaultFragmentShaderCode\n      }),\n      entryPoint: 'main',\n      targets: [{ format }]\n    }\n  };\n\n  t.doCreateRenderPipelineTest(isAsync, !mismatched, descriptor);\n});\n\ng.test('external_texture').\ndesc('Tests createRenderPipeline() with an external_texture').\nfn((t) => {\n  const shader = t.device.createShaderModule({\n    code: `\n        @vertex\n        fn vertexMain() -> @builtin(position) vec4f {\n          return vec4f(1);\n        }\n\n        @group(0) @binding(0) var myTexture: texture_external;\n\n        @fragment\n        fn fragmentMain() -> @location(0) vec4f {\n          let result = textureLoad(myTexture, vec2u(1, 1));\n          return vec4f(1);\n        }\n      `\n  });\n\n  const descriptor = {\n    layout: 'auto',\n    vertex: {\n      module: shader\n    },\n    fragment: {\n      module: shader,\n      targets: [{ format: 'rgba8unorm' }]\n    }\n  };\n\n  t.doCreateRenderPipelineTest(false, true, descriptor);\n});"],"mappings":"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","ignoreList":[]}