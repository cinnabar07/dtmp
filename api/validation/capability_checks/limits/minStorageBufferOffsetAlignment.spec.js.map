{"version":3,"file":"minStorageBufferOffsetAlignment.spec.js","names":["GPUConst","isPowerOfTwo","kMinimumLimitBaseParams","makeLimitTestGroup","getDeviceLimitToRequest","limitValueTest","defaultLimit","minimumLimit","Math","log2","getTestValue","testValueName","requestedLimit","getDeviceLimitToRequestAndValueToTest","maximumLimit","testValue","limit","g","description","test","desc","params","fn","t","limitTest","adapterLimit","testDeviceWithSpecificLimits","device","shouldError","storageBuffer","createBufferTracked","size","usage","GPUBufferUsage","STORAGE","layout","createBindGroupLayout","entries","binding","visibility","GPUShaderStage","COMPUTE","buffer","type","expectValidationError","createBindGroup","resource","offset","ShaderStage","hasDynamicOffset","bindGroup","encoder","globalThis","_TRAMPOLINE_","createCommandEncoder","pass","beginComputePass","setBindGroup","end","finish","destroy","expect"],"sources":["../../../../../../src/webgpu/api/validation/capability_checks/limits/minStorageBufferOffsetAlignment.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/import { GPUConst } from '../../../../constants.js';import { isPowerOfTwo } from '../../../../util/math.js';\nimport {\n  kMinimumLimitBaseParams,\n  makeLimitTestGroup } from\n\n\n'./limit_utils.js';\n\nfunction getDeviceLimitToRequest(\nlimitValueTest,\ndefaultLimit,\nminimumLimit)\n{\n  switch (limitValueTest) {\n    case 'atDefault':\n      return defaultLimit;\n    case 'overDefault':\n      return 2 ** (Math.log2(defaultLimit) + 1);\n    case 'betweenDefaultAndMinimum':\n      return 2 ** ((Math.log2(defaultLimit) + Math.log2(minimumLimit)) / 2 | 0);\n    case 'atMinimum':\n      return minimumLimit;\n    case 'underMinimum':\n      return 2 ** (Math.log2(minimumLimit) - 1);\n  }\n}\n\nfunction getTestValue(testValueName, requestedLimit) {\n  switch (testValueName) {\n    case 'atLimit':\n      return requestedLimit;\n    case 'underLimit':\n      return 2 ** (Math.log2(requestedLimit) - 1);\n  }\n}\n\nfunction getDeviceLimitToRequestAndValueToTest(\nlimitValueTest,\ntestValueName,\ndefaultLimit,\nmaximumLimit)\n{\n  const requestedLimit = getDeviceLimitToRequest(limitValueTest, defaultLimit, maximumLimit);\n  return {\n    requestedLimit,\n    testValue: getTestValue(testValueName, requestedLimit)\n  };\n}\n\nconst limit = 'minStorageBufferOffsetAlignment';\nexport const { g, description } = makeLimitTestGroup(limit);\n\ng.test('createBindGroup,at_over').\ndesc(`Test using createBindGroup at and over ${limit} limit`).\nparams(kMinimumLimitBaseParams).\nfn(async (t) => {\n  const { limitTest, testValueName } = t.params;\n  // note: LimitTest.maximum is the adapter.limits[limit] value\n  const { defaultLimit, adapterLimit: minimumLimit } = t;\n  const { requestedLimit, testValue } = getDeviceLimitToRequestAndValueToTest(\n    limitTest,\n    testValueName,\n    defaultLimit,\n    minimumLimit\n  );\n\n  await t.testDeviceWithSpecificLimits(\n    requestedLimit,\n    testValue,\n    async ({ device, testValue, shouldError }) => {\n      const storageBuffer = t.createBufferTracked({\n        size: testValue * 2,\n        usage: GPUBufferUsage.STORAGE\n      });\n\n      const layout = device.createBindGroupLayout({\n        entries: [\n        {\n          binding: 0,\n          visibility: GPUShaderStage.COMPUTE,\n          buffer: { type: 'storage' }\n        }]\n\n      });\n\n      await t.expectValidationError(() => {\n        device.createBindGroup({\n          layout,\n          entries: [\n          {\n            binding: 0,\n            resource: {\n              buffer: storageBuffer,\n              offset: testValue\n            }\n          }]\n\n        });\n      }, shouldError);\n    }\n  );\n});\n\ng.test('setBindGroup,at_over').\ndesc(`Test using setBindGroup at and over ${limit} limit`).\nparams(kMinimumLimitBaseParams).\nfn(async (t) => {\n  const { limitTest, testValueName } = t.params;\n  // note: LimitTest.maximum is the adapter.limits[limit] value\n  const { defaultLimit, adapterLimit: minimumLimit } = t;\n  const { requestedLimit, testValue } = getDeviceLimitToRequestAndValueToTest(\n    limitTest,\n    testValueName,\n    defaultLimit,\n    minimumLimit\n  );\n\n  await t.testDeviceWithSpecificLimits(\n    requestedLimit,\n    testValue,\n    async ({ device, testValue, shouldError }) => {\n      const buffer = t.createBufferTracked({\n        size: testValue * 2,\n        usage: GPUBufferUsage.STORAGE\n      });\n\n      const layout = device.createBindGroupLayout({\n        entries: [\n        {\n          binding: 0,\n          visibility: GPUConst.ShaderStage.COMPUTE,\n          buffer: {\n            type: 'storage',\n            hasDynamicOffset: true\n          }\n        }]\n\n      });\n\n      const bindGroup = device.createBindGroup({\n        layout,\n        entries: [\n        {\n          binding: 0,\n          resource: {\n            buffer,\n            size: testValue / 2\n          }\n        }]\n\n      });\n\n      const encoder = globalThis._TRAMPOLINE_(\"createCommandEncoder\", device, device.createCommandEncoder, [], () => device.createCommandEncoder());\n      const pass = encoder.beginComputePass();\n      pass.setBindGroup(0, bindGroup, [testValue]);\n      pass.end();\n\n      await t.expectValidationError(() => {\n        encoder.finish();\n      }, shouldError);\n\n      globalThis._TRAMPOLINE_(\"destroy\", buffer, buffer.destroy, [], () => buffer.destroy());\n    }\n  );\n});\n\ng.test('validate,powerOf2').\ndesc('Verify that ${limit} is power of 2').\nfn((t) => {\n  t.expect(isPowerOfTwo(t.defaultLimit));\n  t.expect(isPowerOfTwo(t.adapterLimit));\n});\n\ng.test('validate,greaterThanOrEqualTo32').\ndesc('Verify that ${limit} is >= 32').\nfn((t) => {\n  t.expect(t.defaultLimit >= 32);\n  t.expect(t.adapterLimit >= 32);\n});"],"mappings":"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","ignoreList":[]}