{"version":3,"file":"maxColorAttachments.spec.js","names":["range","kMaxColorAttachmentsToTest","kMaximumLimitBaseParams","makeLimitTestGroup","getPipelineDescriptor","device","testValue","code","module","createShaderModule","layout","vertex","entryPoint","fragment","targets","Array","fill","format","writeMask","limit","g","description","test","desc","params","combine","fn","t","limitTest","testValueName","async","testDeviceWithRequestedMaximumLimits","shouldError","pipelineDescriptor","testCreateRenderPipeline","encoder","globalThis","_TRAMPOLINE_","createCommandEncoder","textures","_","createTextureTracked","size","usage","GPUTextureUsage","RENDER_ATTACHMENT","pass","beginRenderPass","colorAttachments","i","view","createView","loadOp","storeOp","end","expectValidationError","finish","createRenderBundleEncoder","colorFormats","adapter","defaultLimit","adapterLimit","maximumLimit","minColorAttachmentBytesPerSample","getDefaultLimit","expect","limits","maxColorAttachmentBytesPerSample","maxColorAttachments"],"sources":["../../../../../../src/webgpu/api/validation/capability_checks/limits/maxColorAttachments.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/import { range } from '../../../../../common/util/util.js';import { kMaxColorAttachmentsToTest } from '../../../../capability_info.js';\nimport { kMaximumLimitBaseParams, makeLimitTestGroup } from './limit_utils.js';\n\nfunction getPipelineDescriptor(device, testValue) {\n  const code = `\n    @vertex fn vs() -> @builtin(position) vec4f {\n      return vec4f(0);\n    }\n\n    @fragment fn fs() -> @location(0) vec4f {\n      return vec4f(0);\n    }\n  `;\n  const module = device.createShaderModule({ code });\n  return {\n    layout: 'auto',\n    vertex: {\n      module,\n      entryPoint: 'vs'\n    },\n    fragment: {\n      module,\n      entryPoint: 'fs',\n      targets: new Array(testValue).fill({ format: 'r8unorm', writeMask: 0 })\n    }\n  };\n}\n\nconst limit = 'maxColorAttachments';\nexport const { g, description } = makeLimitTestGroup(limit);\n\ng.test('createRenderPipeline,at_over').\ndesc(`Test using at and over ${limit} limit in createRenderPipeline(Async)`).\nparams(kMaximumLimitBaseParams.combine('async', [false, true])).\nfn(async (t) => {\n  const { limitTest, testValueName, async } = t.params;\n  await t.testDeviceWithRequestedMaximumLimits(\n    limitTest,\n    testValueName,\n    async ({ device, testValue, shouldError }) => {\n      const pipelineDescriptor = getPipelineDescriptor(device, testValue);\n\n      await t.testCreateRenderPipeline(pipelineDescriptor, async, shouldError);\n    }\n  );\n});\n\ng.test('beginRenderPass,at_over').\ndesc(`Test using at and over ${limit} limit in beginRenderPass`).\nparams(kMaximumLimitBaseParams).\nfn(async (t) => {\n  const { limitTest, testValueName } = t.params;\n  await t.testDeviceWithRequestedMaximumLimits(\n    limitTest,\n    testValueName,\n    async ({ device, testValue, shouldError }) => {\n      const encoder = globalThis._TRAMPOLINE_(\"createCommandEncoder\", device, device.createCommandEncoder, [], () => device.createCommandEncoder());\n\n      const textures = range(testValue, (_) =>\n      t.createTextureTracked({\n        size: [1, 1],\n        format: 'r8unorm',\n        usage: GPUTextureUsage.RENDER_ATTACHMENT\n      })\n      );\n\n      const pass = encoder.beginRenderPass({\n        colorAttachments: range(testValue, (i) => ({\n          view: textures[i].createView(),\n          loadOp: 'clear',\n          storeOp: 'store'\n        }))\n      });\n      pass.end();\n\n      await t.expectValidationError(() => {\n        encoder.finish();\n      }, shouldError);\n    }\n  );\n});\n\ng.test('createRenderBundle,at_over').\ndesc(`Test using at and over ${limit} limit in createRenderBundle`).\nparams(kMaximumLimitBaseParams).\nfn(async (t) => {\n  const { limitTest, testValueName } = t.params;\n  await t.testDeviceWithRequestedMaximumLimits(\n    limitTest,\n    testValueName,\n    async ({ device, testValue, shouldError }) => {\n      await t.expectValidationError(() => {\n        device.createRenderBundleEncoder({\n          colorFormats: new Array(testValue).fill('r8unorm')\n        });\n      }, shouldError);\n    }\n  );\n});\n\ng.test('validate,maxColorAttachmentBytesPerSample').\ndesc(`Test ${limit} against maxColorAttachmentBytesPerSample`).\nfn((t) => {\n  const { adapter, defaultLimit, adapterLimit: maximumLimit } = t;\n  const minColorAttachmentBytesPerSample = t.getDefaultLimit('maxColorAttachmentBytesPerSample');\n  // The smallest attachment is 1 byte\n  // so make sure maxColorAttachments < maxColorAttachmentBytesPerSample\n  t.expect(defaultLimit <= minColorAttachmentBytesPerSample);\n  t.expect(maximumLimit <= adapter.limits.maxColorAttachmentBytesPerSample);\n});\n\ng.test('validate,kMaxColorAttachmentsToTest').\ndesc(\n  `\n    Tests that kMaxColorAttachmentsToTest is large enough to test the limits of this device\n  `\n).\nfn((t) => {\n  t.expect(t.adapter.limits.maxColorAttachments <= kMaxColorAttachmentsToTest);\n});"],"mappings":"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","ignoreList":[]}