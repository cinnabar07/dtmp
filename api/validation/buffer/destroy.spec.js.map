{"version":3,"file":"destroy.spec.js","names":["description","makeTestGroup","kBufferUsages","GPUConst","ValidationTest","g","test","desc","paramsSubcasesOnly","u","combine","fn","t","usage","params","buf","createBufferTracked","size","globalThis","_TRAMPOLINE_","destroy","getErrorBuffer","combineWithParams","BufferUsage","COPY_SRC","MAP_WRITE","COPY_DST","MAP_READ","mapMode","MapMode","WRITE","READ","unless","p","mappedAtCreation","undefined","unmapBeforeDestroy","unmap","mapAsync"],"sources":["../../../../../src/webgpu/api/validation/buffer/destroy.spec.ts"],"sourcesContent":["/**\n* AUTO-GENERATED - DO NOT EDIT. Source: https://github.com/gpuweb/cts\n**/export const description = `\nValidation tests for GPUBuffer.destroy.\n`;import { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { kBufferUsages } from '../../../capability_info.js';\nimport { GPUConst } from '../../../constants.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('all_usages').\ndesc('Test destroying buffers of every usage type.').\nparamsSubcasesOnly((u) =>\nu //\n.combine('usage', kBufferUsages)\n).\nfn((t) => {\n  const { usage } = t.params;\n  const buf = t.createBufferTracked({\n    size: 4,\n    usage\n  });\n\n  globalThis._TRAMPOLINE_(\"destroy\", buf, buf.destroy, [], () => buf.destroy());\n});\n\ng.test('error_buffer').\ndesc('Test that error buffers may be destroyed without generating validation errors.').\nfn((t) => {\n  const buf = t.getErrorBuffer();\n  globalThis._TRAMPOLINE_(\"destroy\", buf, buf.destroy, [], () => buf.destroy());\n});\n\ng.test('twice').\ndesc(\n  `Test that destroying a buffer more than once is allowed.\n      - Tests buffers which are mapped at creation or not\n      - Tests buffers with various usages`\n).\nparamsSubcasesOnly((u) =>\nu //\n.combine('mappedAtCreation', [false, true]).\ncombineWithParams([\n{ size: 4, usage: GPUConst.BufferUsage.COPY_SRC },\n{ size: 4, usage: GPUConst.BufferUsage.MAP_WRITE | GPUConst.BufferUsage.COPY_SRC },\n{ size: 4, usage: GPUConst.BufferUsage.COPY_DST | GPUConst.BufferUsage.MAP_READ }]\n)\n).\nfn((t) => {\n  const buf = t.createBufferTracked(t.params);\n\n  globalThis._TRAMPOLINE_(\"destroy\", buf, buf.destroy, [], () => buf.destroy());\n  globalThis._TRAMPOLINE_(\"destroy\", buf, buf.destroy, [], () => buf.destroy());\n});\n\ng.test('while_mapped').\ndesc(\n  `Test destroying buffers while mapped or after being unmapped.\n      - Tests {mappable, unmappable mapAtCreation, mappable mapAtCreation}\n      - Tests while {mapped, mapped at creation, unmapped}`\n).\nparamsSubcasesOnly((u) =>\nu //\n.combine('mappedAtCreation', [false, true]).\ncombine('unmapBeforeDestroy', [false, true]).\ncombineWithParams([\n{ usage: GPUConst.BufferUsage.COPY_SRC },\n{ usage: GPUConst.BufferUsage.MAP_WRITE | GPUConst.BufferUsage.COPY_SRC },\n{ usage: GPUConst.BufferUsage.COPY_DST | GPUConst.BufferUsage.MAP_READ },\n{\n  usage: GPUConst.BufferUsage.MAP_WRITE | GPUConst.BufferUsage.COPY_SRC,\n  mapMode: GPUConst.MapMode.WRITE\n},\n{\n  usage: GPUConst.BufferUsage.COPY_DST | GPUConst.BufferUsage.MAP_READ,\n  mapMode: GPUConst.MapMode.READ\n}]\n).\nunless((p) => p.mappedAtCreation === false && p.mapMode === undefined)\n).\nfn(async (t) => {\n  const { usage, mapMode, mappedAtCreation, unmapBeforeDestroy } = t.params;\n  const buf = t.createBufferTracked({\n    size: 4,\n    usage,\n    mappedAtCreation\n  });\n\n  if (mapMode !== undefined) {\n    if (mappedAtCreation) {\n      buf.unmap();\n    }\n    await globalThis._TRAMPOLINE_(\"mapAsync\", buf, buf.mapAsync, [mapMode], () => buf.mapAsync(mapMode));\n  }\n  if (unmapBeforeDestroy) {\n    buf.unmap();\n  }\n\n  globalThis._TRAMPOLINE_(\"destroy\", buf, buf.destroy, [], () => buf.destroy());\n});"],"mappings":"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","ignoreList":[]}